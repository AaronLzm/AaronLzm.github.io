---
date: 2025-11-24 15:00:50
title: Horvitz-Thompson estimators是什么？
category: Causal inference
tags: [Chapter 12,What-if book reading notes]
---


### 第一步：为什么要发明这个东西？（发现问题）

想象你要调查一个村子里所有人的**总收入**。

**情况 A（简单模式）：**
你搞了一个大抽奖箱，把村里每个人的名字写在一样大的纸条上。你闭着眼睛随便摸出 10 个人。
这时候，每个人被抽到的概率是一样的（比如都是 10%）。
那你只需要把这 10 个人的钱加起来，再乘以 10，大概就是全村的钱了。这叫简单随机抽样。

**情况 B（地狱模式 - 也就是现实）：**
在这个村子里，有些人特别爱社交（比如村长、土豪），天天在广场上晃悠，你一出门就能撞见他们。
有些人是社恐（比如宅男、隐士），常年躲在地窖里，你很难抓到他们。

如果你还是像傻瓜一样，出门撞见谁就问谁（抽样），然后直接算平均数，会发生什么？
**结果会严重偏颇！** 你会采集到一大堆“爱社交的人”的数据，而那些“社恐”的声音被你忽略了。如果土豪爱社交，你的结果就会显示这个村子富得流油，但这不代表真实情况。

**Horvitz-Thompson 就是为了解决“每个人被抽到的概率不一样”这个问题的。**

---

### 第二步：怎么解决？（核心直觉）

既然我们知道抽样是不公平的，那我们在算账的时候，就要**把这种不公平“怼”回去**。

核心逻辑只有一句话：
**谁越难被抽中，谁的一票就越值钱；谁越容易被抽中，谁的一票就越廉价。**

*   **容易被抽中的人（概率 $\pi$ 很大）：** 他代表不了多少人，因为像他这样的人满大街都是，我都采到了。所以，我要**降低**他的权重。
*   **很难被抽中的人（概率 $\pi$ 很小）：** 比如那个躲在地窖里的宅男，我好不容易才抓到一个。这意味着由于概率低，可能还有 99 个像他一样的宅男我没抓到。所以，这一个宅男要代表那 99 个没出现的兄弟。我要**通过加倍**他的权重，让他发出巨大的声音。

这叫 **“倒数加权” (Inverse Probability Weighting)**。

---

### 第三步：看公式（此时它已经不吓人了）

假设：
*   $y_i$ 是你抓到的第 $i$ 个人的收入。
*   $\pi_i$ 是第 $i$ 个人被抓到的概率（Incusion Probability）。

普通的加法是：$y_1 + y_2 + ...$ （这是错的，因为不公平）

**Horvitz-Thompson 的加法是：**
$$ \hat{Y}_{HT} = \sum \frac{y_i}{\pi_i} $$

也就是：**（第1个人的钱 ÷ 他被抽中的概率）+ （第2个人的钱 ÷ 他被抽中的概率）...**

**我们来算个账你就懂了：**

1.  **遇见村长：**
    村长天天在外面，被抽中概率 $\pi = 1.0$ (100%)。
    他对总量的贡献 = $\frac{\text{村长的钱}}{1}$。
    *解释：除以1，权重不变。因为他就在那，他只代表他自己。*

2.  **遇见社恐宅男：**
    宅男很难找，被抽中概率只有 $\pi = 0.01$ (1%)。
    他对总量的贡献 = $\frac{\text{宅男的钱}}{0.01}$ = **宅男的钱 $\times$ 100**。
    *解释：因为他只有 1% 的几率出现，所以我一旦抓住了他，我就默认还有 99 个像他一样的人没被抓到。所以我把他的钱乘以 100，让他代表那 100 个隐形的人。*

---

### 总结：Horvitz-Thompson 到底是什么？

1.  **定义：** 它是在**不等概率抽样**（Unequal Probability Sampling）下，用来估计总体总量（Total）或均值的一种方法。
2.  **做法：** 每一个样本的观测值，都要除以它**被选中的概率**。
3.  **性质：** 它是**无偏**（Unbiased）的。意思就是，只要你知道每个样本被选中的确切概率，用这个公式算出来的结果，长期来看是准确命中靶心的，不会偏左也不会偏右。

