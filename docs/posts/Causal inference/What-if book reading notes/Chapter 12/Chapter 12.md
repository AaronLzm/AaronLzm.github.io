---
date: 2025-09-17 11:19:05
title: Chapter 12
category: Causal inference
tags: [Chapter 12,What-if book reading notes]
---

以下是《因果推断》第12章的核心内容总结及注意事项，分步梳理关键概念与方法：

---

### **核心内容总结**
1. **研究背景与目标**  
   - **因果问题**：估计戒烟（A）对体重增加（Y）的平均因果效应（ACE），即 \( E[Y^{a=1}] - E[Y^{a=0}] \)。  
   - **数据来源**：NHEFS（美国国家健康与营养调查随访研究），基线（1971-75）和随访（1982）数据，样本量1566名吸烟者。  
   - **初步关联结果**：戒烟组平均增重4.5kg，非戒烟组2.0kg，差值2.5kg（95% CI: 1.7~3.4），但存在混杂偏倚（如戒烟者年龄更大）。

2. **IP加权（逆概率加权）原理**  
   - **目的**：创建伪总体（Pseudo-population），消除治疗A与协变量L的关联，实现无混杂比较。  
   - **权重计算**：  
     - **非稳定权重**：\( W_A = 1 / f(A|L) \)  
     - **稳定权重**：\( SW_A = f(A) / f(A|L) \)（更优，减少方差）  
   - **步骤**：  
     1. 拟合倾向性评分模型（如Logistic回归）：估计 \( \text{Pr}[A=1|L] \)。  
     2. 计算权重：戒烟者 \( SW_A = \frac{\text{Pr}[A=1]}{\text{Pr}[A=1|L]} \)，非戒烟者 \( SW_A = \frac{\text{Pr}[A=0]}{1 - \text{Pr}[A=1|L]} \)。  
     3. 加权分析：拟合加权模型 \( E[Y|A] = \theta_0 + \theta_1 A \)（最小二乘法）。  
   - **结果**：ACE估计值3.4kg（95% CI: 2.4~4.5）。

3. **边际结构模型（MSM）**  
   - **定义**：直接建模反事实结果均值，如 \( $$E[Y^a] = \beta_0 + \beta_1 a $$\)（饱和模型）。  
   - **估计方法**：  
     - 使用IP权重创建伪总体，拟合关联模型 \( E[Y|A] = \theta_0 + \theta_ 1 A \)（伪总体中关联=因果）。  
     - 参数 \( \theta_1 \) 估计ACE（\( \beta_1 \)）。  
   - **扩展应用**：  
     - **连续处理**（如吸烟量变化ΔA）：  
       - 模型：\($$ E[Y^a] = \beta_0 + \beta_1 a + \beta_2 a^2 $$\)（非饱和）。  
       - 需估计条件密度 \( f(A|L) \)（假设正态分布，敏感性高）。  
     - **二值结局**（如死亡风险）：Logistic MSM \($$ \text{logit Pr}[D^a=1] = \alpha_0 + \alpha_1 a $$\)。

4. **处理缺失数据（删失）**  
   - **问题**：仅分析完整数据（C=0）可能引入选择偏倚（删失与A或L相关）。  
   - **解决方案**：  
     - **联合权重**：\( SW_{A,C} = SW_A \times SW_C \)，其中 \( SW_C = \frac{\text{Pr}[C=0|A]}{\text{Pr}[C=0|L,A]} \)。  
     - 估计 \( E[Y^{a,c=0}] \)（假设无删失下的因果效应）。  
   - **结果**：校正后ACE≈3.5kg（与未校正结果相似）。

5. **效应修饰（Effect Modification）**  
   - **方法**：在MSM中加入协变量（如性别V）：  
     - 模型：\( E[Y^a|V] = \beta_0 + \beta_1 a + \beta_2 V a + \beta_3 V \)。  
     - 使用稳定权重 \( SW_A(V) = f(A|V)/f(A|L) \) 提高效率。  
   - **结果**：无证据表明性别修饰戒烟效应（\( \beta_2 \) 95% CI: -2.2~1.9）。

---

### **关键注意事项**
1. **倾向性评分模型**  
   - **协变量选择**：必须包含所有混杂因子（影响A和Y），禁止包含中介或工具变量。  
   - **模型诊断**：  
     - 检查权重均值（稳定权重应≈1）。  
     - 平衡性检验（加权后组间协变量SMD<0.1）。  
   - **极端权重处理**：裁剪（Trimming）或使用稳定权重减少方差。

2. **非正性（Positivity）问题**  
   - **类型**：  
     - **结构性**：某些L下A不可能发生（需限制分析范围）。  
     - **随机性**：有限样本导致的零单元格（用模型平滑插值）。  
   - **影响**：非正性时ACE仅适用于可观测子群体（\( Q(a) = \{l: \text{Pr}[A=a|L=l]>0\} \)）。

3. **模型误设风险**  
   - **倾向性模型**：误设导致偏倚（需验证平衡性）。  
   - **MSM模型**：非饱和模型（如连续处理）对函数形式敏感（可尝试多种分布假设）。  
   - **双稳健估计**：结合倾向性评分与结局模型，提高鲁棒性（第13章）。

4. **删失与选择偏倚**  
   - **假设**：交换性 \( Y^{a,c=0} \perp (A,C) | L \)（若L含中介变量则可能不成立）。  
   - **敏感分析**：评估删失机制（如比较基线特征）。

5. **计算实践**  
   - **置信区间**：使用稳健方差估计或自助法（Bootstrap）。  
   - **软件实现**：加权最小二乘法（如R的 `lm()` 加权重参数）。  
   - **连续处理**：避免直接IP加权（改用参数化g-formula或TMLE，第14章）。

---

### **案例特殊性与局限**
- **选择偏倚风险**：仅纳入存活至1982年的个体（戒烟状态已知），可能低估效应（死亡与戒烟相关）。  
- **时变治疗简化**：真实场景中戒烟为时变处理，本章简化处理（时变方法见Part III）。  
- **协变量控制**：假设9个基线变量（年龄、性别等）足以调整混杂，但未测量未观测混杂因子。

---

### **总结**
本章通过NHEFS案例演示了IP加权与MSM的完整流程：  
1. **定义因果问题**→2. **计算IP权重**→3. **拟合MSM**→4. **处理缺失数据**。  
核心思想：**利用权重模拟随机试验环境**，在伪总体中估计反事实结果。实践需警惕模型误设、非正性及选择偏倚，并通过诊断确保结果可靠性。