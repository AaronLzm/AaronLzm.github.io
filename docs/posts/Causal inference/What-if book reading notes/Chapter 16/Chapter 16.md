---
title: Chapter 16
category: Causal inference
tags: [Chapter 16,What-if book reading notes]

---
### Chapter 16: Instrumental Variable Estimation  
**核心目标**：在存在未测量混杂时估计因果效应，通过工具变量（IV）绕过传统调整方法的需求。  

---

#### **16.1 工具变量的三个条件**  
一个变量 \( Z \) 成为有效工具需满足：  
1. **关联性 (Relevance)**:  
   \( Z \) 与处理 \( A \) 相关：  
   \[
   \Pr[A=1|Z=1] - \Pr[A=1|Z=0] \neq 0 \quad \text{(或更一般形式 } Z \not\perp A\text{)}
   \]  
2. **排他性约束 (Exclusion Restriction)**:  
   \( Z \) 仅通过 \( A \) 影响结果 \( Y \)，无直接路径：  
   \[
   Y_i^{z,a} = Y_i^{z',a} = Y_i^a \quad \text{(个体层)} \quad \text{或} \quad E[Y^{z,a}] = E[Y^{z',a}] \quad \text{(群体层)}
   \]  
3. **可交换性 (Exchangeability)**:  
   \( Z \) 与 \( Y \) 无共同原因（无混杂）：  
   \[
   Y^{a,z} \perp Z \quad \text{(或更严格的联合可交换性)}
   \]  

> **关键结论**：  
> - 仅条件 (i) 可经验验证（如 RCT 中 \( Z \) 为随机分配）。  
> - 条件 (ii) 和 (iii) **不可验证**，需依赖领域知识假设成立（如双盲试验）。  

---

#### **16.2 标准 IV 估计量**  
当 \( Z \) 为二值工具变量时，**因果效应估计量**为：  
\[
\text{IV Estimand} = \frac{E[Y|Z=1] - E[Y|Z=0]}{E[A|Z=1] - E[A|Z=0]}
\]  
**计算方法**：  
1. **两阶段最小二乘法 (2SLS)**:  
   - 第一阶段：拟合 \( A \) 对 \( Z \) 的回归： \( E[A|Z] = \alpha_0 + \alpha_1 Z \)  
   - 第二阶段：拟合 \( Y \) 对预测值 \( \hat{A} \) 的回归： \( E[Y|\hat{A}] = \beta_0 + \beta_1 \hat{A} \)  
   - 估计值 \( \hat{\beta}_1 \) 等于 IV 估计量。  
2. **结构均值模型 (Structural Mean Models)**:  
   - 加性模型： \( E[Y - Y^{a=0} | A, Z] = A (\beta_0 + \beta_1 Z) \)  
   - 乘性模型： \( E[Y|A,Z] = E[Y^{a=0}|A,Z] \exp[A(\beta_0 + \beta_1 Z)] \)  

> **示例**（戒烟对体重的影响）：  
> - 工具 \( Z \)：香烟价格 > $1.50（二值）  
> - 估计值： \( \hat{\beta}_1 = 2.4  \text{kg} \) （95% CI: -36.5, 41.3）  

---

#### **16.3 第四识别条件：同质性 (Homogeneity)**  
仅工具变量三个条件**不足**以识别平均因果效应 \( E[Y^{a=1}] - E[Y^{a=0}] \)，需额外条件：  
1. **常数效应假设**：所有个体因果效应相同（强假设，通常不成立）。  
2. **处理效应在 \( Z \) 水平同质**：  
   \[
   E[Y^{a=1} - Y^{a=0} | Z=1, A=a] = E[Y^{a=1} - Y^{a=0} | Z=0, A=a] \quad (a=0,1)
   \]  
3. **无混杂效应修饰**：  
   \[
   E[Y^{a=1} | U] - E[Y^{a=0} | U] = \text{常数} \quad \text{(或与 } t(U) \text{ 不相关)}
   \]  
   **一般同质性条件**：  
   \[
   \text{Cov}\left( e(U), t(U) \right) = 0, \quad \text{其中 } e(U) = E[Y^{a=1}-Y^{a=0}|U], \  t(U) = E[A|Z=1,U] - E[A|Z=0,U]
   \]  

---

#### **16.4 替代第四条件：单调性 (Monotonicity)**  
若同质性不成立，可用单调性替代：  
- **定义**：无反抗者（Defiers），即 \( A^{z=1} \geq A^{z=0} \) 对所有个体成立。  
- **估计目标**：顺从者（Compliers）的平均因果效应（CACE/LATE）：  
  \[
  E[Y^{a=1} - Y^{a=0} | A^{z=1}=1, A^{z=0}=0] = \frac{E[Y|Z=1] - E[Y|Z=0]}{E[A|Z=1] - E[A|Z=0]}
  \]  

> **局限**：  
> 1. **可解释性**：顺从者群体未观测且随工具变化。  
> 2. **单调性合理性**：观察性研究中可能违反（如医生偏好存在多维决策）。  
> 3. **替代工具问题**：若 \( Z \) 非因果工具（如代理变量），CACE 解释无效。  

---

#### **16.5 工具变量条件再讨论**  
##### **弱工具变量问题 (Weak Instruments)**  
- **定义**：  
  - 实质性弱： \( |E[A|Z=1] - E[A|Z=0]| \) 过小（如 < 10%）。  
  - 统计性弱：一阶段回归 F 统计量 < 10。  
- **后果**：  
  1. 估计置信区间宽。  
  2. **放大偏误**：条件 (ii)-(iii) 的微小违反被分母放大（偏误 × \( 1/\text{分母} \)）。  
  3. 有限样本偏误（即使工具有效）。  

##### **条件 (ii)-(iii) 的违反**  
- **直接效应违反 (图 16.8)**：工具 \( Z \) 存在直达 \( Y \) 的路径（如 \( A \) 被粗化时）。  
- **混杂违反 (图 16.10)**：\( Z \) 与 \( Y \) 存在共同原因（观察性研究常见）。  
- **选择偏误**：分析时排除某些 \( A \) 的取值可能引入偏误。  

##### **缓解策略**：  
- 调整已测协变量 \( V \)（分层或纳入模型）。  
- 检查 \( V \) 在 \( Z \) 水平的平衡性（但无法保证未测混杂平衡）。  

---

#### **16.6 IV 估计 vs. 其他方法**  
| **特征**               | **IV 估计**                                | **IP 加权/标准化**                 |
|------------------------|--------------------------------------------|-----------------------------------|
| **核心假设**           | 工具变量条件 + 同质/单调性                 | 给定 \( V \) 后处理组可交换       |
| **未测混杂处理**       | 可绕过                                    | 需完全测量混杂                   |
| **偏误敏感性**         | **高**（弱工具或小违反导致大偏误）         | 低（小违反导致小偏误）           |
| **适用场景**           | 二元处理、强工具、单调性合理               | 时间依存处理、多阶段策略         |

> **关键洞见**：  
> - IV 的附加价值在于**假设三角验证**（与其他方法假设不同）。  
> - 但 IV 置信区间通常较宽，且偏误方向反直觉。  

---

### Technical Points 结论  
- **TP 16.1**：工具条件 (ii) 和 (iii) 的严格定义依赖反事实独立性（如 \( Y^{a,z} \perp Z \)）。  
- **TP 16.2**：工具变量可缩小区分因果效应的**自然界限**（Natural Bounds）。  
- **TP 16.3**：标准 IV 估计量等价于加性结构均值模型在 \( \beta_1=0 \) 时的参数。  
- **TP 16.4**：乘性结构均值模型导出不同的 IV 估计量（风险比尺度）。  
- **TP 16.5**：一般同质性条件 \( \text{Cov}(e(U), t(U))=0 \) 是 IV 估计无偏的充分条件。  
- **TP 16.6**：带协变量的结构均值模型可通过 G 估计扩展至时变处理。  
- **TP 16.7**：单调性下 IV 估计量识别顺从者效应（需 \( Z \) 为因果工具）。  

---

### Fine Points 结论  
- **FP 16.1**：观察性研究中常见工具类型：  
  - **遗传变异**（如孟德尔随机化）。  
  - **医生偏好**（如最后处方代理）。  
  - **可及性**（如距离、时间、价格）。  
- **FP 16.2**：弱工具定义（实质性与统计性）及其三重问题。  
- **FP 16.3**：断点回归设计（RDD）作为 IV 替代：  
  - **核心假设**：在分配阈值 \( L=c \) 处，\( E[Y^a|L] \) 连续。  
  - **估计**：阈值两侧局部平均因果效应（如年龄 65±ε 人群）。  
  - **类型**：  
    - 清晰断点（处理概率 0→1）。  
    - 模糊断点（处理概率跳跃 <1，需单调性识别顺从者效应）。  

---

### 关键总结  
1. **IV 估计依赖强假设**：三个工具条件 + 第四条件（同质/单调）。  
2. **实践挑战**：  
   - 条件 (ii)-(iii) 不可验证，需领域知识论证。  
   - 弱工具导致估计不稳定且放大偏误。  
   - 单调性下仅识别顺从者效应（可能缺乏外推性）。  
3. **适用性**：IV 最适合二元处理、强工具、且存在明确自然实验的场景（如 RCT 未依从）。  

> **透明性要求**：报告工具强度（F 统计量）、第四条件合理性、敏感性分析。