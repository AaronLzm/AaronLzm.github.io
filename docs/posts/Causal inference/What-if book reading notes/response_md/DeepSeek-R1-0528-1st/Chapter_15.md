---
date: 2025-09-17 11:19:05
title: Chapter_15
category: Causal inference
tags: [DeepSeek-R1-0528-1st,response_md]

---
<think>
我们正在处理《因果推断：What If》第15章的内容。这一章主要讨论了结果回归（Outcome Regression）和倾向评分（Propensity Scores）方法。我将按照章节结构提炼技术重点和细节要点，并确保不遗漏任何重要细节。数学公式会使用LaTeX格式。

### 第15章：结果回归与倾向评分
- **核心观点**：结果回归和倾向评分分析是最常用的参数化因果推断方法，但它们通常不适用于处理时变治疗的复杂性（在第三部分会再次讨论g方法）。
- **章节结构**：
  1. **15.1 结果回归（Outcome Regression）**
  2. **15.2 倾向评分（Propensity Scores）**
  3. **15.3 倾向分层与标准化（Propensity Stratification and Standardization）**
  4. **15.4 倾向匹配（Propensity Matching）**
  5. **15.5 倾向模型、结构模型与预测模型（Propensity Models, Structural Models, Predictive Models）**

---

### 技术重点与细节要点

#### 15.1 结果回归
- **目标**：估计吸烟 cessation（治疗A）对体重增加（结果Y）的平均因果效应。
- **平均因果效应定义**：$E[Y^{a=1,c=0}] - E[Y^{a=0,c=0}]$，其中c=0表示未删失。
- **假设**：在变量L（性别、年龄、种族、教育、吸烟强度、持续时间、日常体力活动、娱乐锻炼、体重）条件下，处理组和未处理组可交换（条件可交换性）。
- **方法**：
  - 使用结构嵌套模型（Structural Nested Models），该模型包含治疗A和变量L的交互项，但不包含L的主效应（因为不关心L与Y的非因果关系）。
  - 如果愿意指定L和Y在A水平内的关联，可考虑结构模型：
    $$
    E[Y^{a,c=0}|L] = \beta_0 + \beta_1 a + \beta_2 a L + \beta_3 L
    $$
    - $\beta_1$和$\beta_2$：在L的每个层内，A对Y的平均因果效应。
    - $\beta_0$和$\beta_3$：在未治疗条件下（$a=0$），反事实结果均值随L的变化（$\beta_3$不是L的因果效应，仅是关联）。
  - **估计**：通过最小二乘法拟合结果回归模型：
    $$
    E[Y|A, C=0, L] = \alpha_0 + \alpha_1 A + \alpha_2 A L + \alpha_3 L
    $$
    - 如果L足以调整混杂（和选择偏倚）且模型正确指定，则$\alpha = \beta$。
- **实例结果**：
  - 包含交互项（A与吸烟强度）：$\hat{\beta}_1 = 2.6$, $\hat{\beta}_2 = 0.05$。
    - 吸烟5支/天者：效应估计2.8 kg (95% CI: 1.5, 4.1)。
    - 吸烟40支/天者：效应估计4.4 kg (95% CI: 2.8, 6.1)。
  - 无交互项（假设无效应修饰）：效应估计3.5 kg (95% CI: 2.6, 4.3)。
- **离散结局**：可使用逻辑回归模型（如二分类Y）。

#### 15.2 倾向评分
- **定义**：倾向评分 $\pi(L) = \Pr[A=1|L]$，表示给定协变量L下个体接受治疗的概率。
- **性质**：
  - 在理想随机试验中，$\pi(L) = 0.5$（对所有L）。
  - 观察性研究中，$\pi(L)$未知，需从数据估计（如通过逻辑回归）。
- **平衡性**：若$\pi(L)$相同，则处理组和未处理组的协变量L分布相同，即$A \perp\!\!\!\perp L | \pi(L)$（倾向评分平衡协变量）。
- **关键结果**：条件可交换性$Y^a \perp\!\!\!\perp A | L$ 蕴含 $Y^a \perp\!\!\!\perp A | \pi(L)$，且正性条件在L水平和$\pi(L)$水平等价。
- **应用**：倾向评分可用于分层、标准化、匹配来估计因果效应。

#### 15.3 倾向分层与标准化
- **方法**：
  - **分层**：将$\pi(L)$分为若干层（如十分位数），每层内估计条件因果效应$E[Y|A=1, C=0, \pi(L)=s] - E[Y|A=0, C=0, \pi(L)=s]$。
    - 问题：连续$\pi(L)$在同一层内仍可能有差异，影响可交换性。
  - **回归调整**：将$\pi(L)$作为连续变量纳入结果回归模型（如线性或样条项），避免分层问题。
    - 实例：效应估计3.6 kg (95% CI: 2.7, 4.5)。
  - **标准化**：为估计总体平均因果效应，用$\pi(L)$分布标准化条件均值（类似第13章）。
    - 实例：效应估计3.6 kg (95% CI: 2.7, 4.6)。
- **效应修饰**：若假设$\pi(L)$无效应修饰，可不包含交互项（但需验证）。

#### 15.4 倾向匹配
- **目标**：构建匹配人群，使处理组和未处理组有相同$\pi(L)$分布。
- **方法**：为每个处理个体匹配一个或多个未处理个体（$\pi(L)$值接近，如$\pm 0.05$）。
- **权衡**：
  - 匹配标准过松：$\pi(L)$分布不同，可交换性不成立。
  - 匹配标准过紧：样本量减少，置信区间变宽。
- **正性问题**：若$\pi(L)$无重叠（如某些处理组$\pi(L)$值高于所有未处理组），匹配会排除这些个体（不区分随机/结构非正性）。
- **目标人群**：匹配后效应估计可能仅适用于特定子群（如“处理组”），且难以描述（因$\pi(L)$无实际意义）。

#### 15.5 倾向模型、结构模型与预测模型
- **倾向模型**：
  - 估计$\Pr[A=1|L]$，参数为讨厌参数（无因果解释）。
  - 用于IP加权、g-估计、匹配、分层。
- **结构模型**：
  - 描述治疗A与反事实结果$Y^a$的关系（如边际结构模型、结构嵌套模型）。
  - 治疗参数有因果解释（如$Y^a$的差异）。
- **预测模型**：
  - 目标：预测结果（如购买概率、疾病风险），非因果推断。
  - 所有协变量地位相同（无治疗A和变量L之分）。
- **变量选择误区**：
  - 预测模型：选择提升预测能力的变量（如逐步回归、机器学习）。
  - 因果模型：只需包含保证可交换性的L，无关变量可能增加方差或偏倚（如工具变量、碰撞器）。
  - **警告**：倾向模型不需完美预测A，只需足够调整混杂。

---

### 结论
- **适用性**：结果回归和倾向评分方法简单常用，但仅适用于固定治疗场景，不适用于时变治疗（第三部分将讨论g方法）。
- **核心假设**：可交换性、正性、一致性。
- **模型要求**：正确指定函数形式（如用样条避免线性假设），避免无关变量。
- **倾向评分方法**：分层、标准化、匹配各有利弊，需注意目标人群定义和可迁移性。
- **重要区分**：因果模型（关注治疗效应） vs. 预测模型（关注关联），勿混淆变量选择策略。

此总结严格基于文本，未添加主观内容，确保技术细节完整。
</think>
### 第15章：结果回归与倾向评分（OUTCOME REGRESSION AND PROPENSITY SCORES）  
**核心观点**：结果回归和倾向评分是常用的参数化因果推断方法，但仅适用于简单场景（如固定治疗），无法处理时变治疗的复杂性（需使用g-methods）。本章聚焦其有限适用性。

---

#### **15.1 结果回归（Outcome Regression）**
1. **目标与模型**  
   - 估计吸烟 cessation（治疗 \(A\)）对体重 gain（结局 \(Y\)）的因果效应。  
   - 结构模型（faux marginal structural model）：  
     \[
     E[Y^{a,c=0}|L] = \beta_0 + \beta_1 a + \beta_2 a L + \beta_3 L
     \]
     - \(\beta_1, \beta_2\)：治疗 \(A\) 在 \(L\) 各层内的因果效应（\(\beta_1\) 为基准效应，\(\beta_2\) 为效应修饰）。  
     - \(\beta_0, \beta_3\)：讨厌参数（nuisance parameters），描述 \(Y^{a=0,c=0}\) 与 \(L\) 的非因果关联（\(\beta_3\) 非 \(L\) 的因果效应）。  

2. **估计方法**  
   - 通过最小二乘拟合结果回归模型：  
     \[
     E[Y|A, C=0, L] = \alpha_0 + \alpha_1 A + \alpha_2 A L + \alpha_3 L
     \]
   - **假设**：若 \(L\) 足以调整混杂/选择偏倚且模型正确，则 \(\alpha = \beta\)。  
   - **实例**：  
     - 含交互项（吸烟强度）：\(\hat{\beta}_1 = 2.6, \hat{\beta}_2 = 0.05\) → 吸烟 5支/天者效应 2.8 kg (95% CI: 1.5, 4.1)，40支/天者 4.4 kg (95% CI: 2.8, 6.1)。  
     - 无交互项（假设无效应修饰）：效应 3.5 kg (95% CI: 2.6, 4.3)。  

3. **关键局限**  
   - 依赖 \(L-Y\) 关联的正确设定（错误指定导致偏倚）。  
   - 与结构嵌套模型对比：后者不建模 \(L-Y\) 关系，但依赖治疗模型正确性（见 Fine Point 15.1）。  

---

#### **15.2 倾向评分（Propensity Scores）**
1. **定义与性质**  
   - 倾向评分 \(\pi(L) = \Pr[A=1|L]\)，衡量给定 \(L\) 的治疗倾向。  
   - **平衡性**：若 \(L\) 满足可交换性，则 \(\pi(L)\) 也满足：  
     \[
     A \perp\!\!\!\perp L \mid \pi(L) \quad \text{且} \quad Y^a \perp\!\!\!\perp A \mid \pi(L)
     \]
   - **估计**：通过逻辑回归（如 \(\text{logit} \Pr[A=1|L] = \alpha_0 + \alpha_1 L\)）。  

2. **核心定理（Rosenbaum & Rubin, 1983）**  
   - 若基于 \(L\) 的可交换性/正性成立，则基于 \(\pi(L)\) 也成立（见 Technical Point 15.1）。  
   - 倾向评分是平衡评分（balancing score）的最简形式。  

---

#### **15.3 倾向分层与标准化（Propensity Stratification and Standardization）**
1. **分层法**  
   - 步骤：  
     1. 估计 \(\hat{\pi}(L)\)，按十分位数分层。  
     2. 每层内计算效应 \(E[Y|A=1, C=0, \pi(L)=s] - E[Y|A=0, C=0, \pi(L)=s]\)。  
   - **问题**：连续 \(\pi(L)\) 在层内分布可能不同 → 可交换性不严格成立。  
   - **实例**：效应范围 0.0–6.6 kg（置信区间宽）。  

2. **回归调整**  
   - 将 \(\hat{\pi}(L)\) 作为连续变量纳入结果回归：  
     \[
     E[Y|A, C=0, \pi(L)] = \alpha_0 + \alpha_1 A + \alpha_2 \pi(L)
     \]
     - **实例**：效应 3.6 kg (95% CI: 2.7, 4.5)。  
   - **优势**：避免分层离散化问题；可用样条（splines）增强灵活性。  

3. **标准化法**  
   - 标准化条件均值至总体：  
     \[
     E[Y^{a,c=0}] = \sum_s E[Y|A=a, C=0, \pi(L)=s] \cdot \Pr[\pi(L)=s]
     \]
     - **实例**：效应 3.6 kg (95% CI: 2.7, 4.6)。  

---

#### **15.4 倾向匹配（Propensity Matching）**
1. **方法**  
   - 为每个处理个体匹配未处理个体（\(\hat{\pi}(L)\) 相近，如 \(\pm 0.05\)），形成匹配人群。  
   - **目标**：在匹配人群中实现 \(A \perp\!\!\!\perp \pi(L)\)。  

2. **挑战**  
   - **偏差-方差权衡**：  
     - 宽松匹配 → \(\pi(L)\) 分布差异 → 可交换性不成立。  
     - 严格匹配 → 样本减少 → 置信区间变宽。  
   - **正性问题**：  
     - 若 \(\hat{\pi}(L)\) 无重叠（如高倾向个体无对照），匹配会排除个体（不区分随机/结构非正性）。  
   - **目标人群模糊**：匹配后效应仅适用于成功匹配的子群（难解释或外推）。  

3. **对比其他方法**  
   - 倾向回归/标准化保留全样本，假设随机非正性；匹配强制限制样本。  

---

#### **15.5 倾向模型、结构模型与预测模型**
1. **模型类型对比**  
   | **模型类型**       | **目标**                     | **参数性质**               | **依赖正确性**       |
   |--------------------|------------------------------|----------------------------|----------------------|
   | 倾向模型           | 估计 \(\Pr[A=1\|L]\)         | 讨厌参数（无因果解释）     | 治疗模型            |
   | 结构模型（因果）   | 直接建模 \(Y^a\) 与 \(A\) 关系 | 因果参数（如 \(\beta_1\)） | 结构模型形式        |
   | 预测模型           | 预测 \(Y\)（非因果）          | 关联参数                   | 预测准确性          |

2. **变量选择误区**  
   - **因果 vs. 预测**：  
     - 预测模型：选择提升预测力的变量（如机器学习、逐步回归）。  
     - 因果模型：只需包含保证可交换性的 \(L\)，无关变量可能：  
       - 增加方差（如医院变量导致非重叠）。  
       - 引入偏倚（如调整碰撞器或工具变量）。  
   - **关键警告**：倾向模型不需完美预测 \(A\)（例：若 \(\pi(L)=0.99/0.01\)，估计方差无限大）。  

3. **结构模型类型**  
   - **边际结构模型（MSM）**：参数化 \(E[Y^a]\)，可选效应修饰 \(V\)。  
   - **结构嵌套模型（SNM）**：参数化 \(E[Y^a - Y^{a=0} \mid L]\)。  

---

### **结论**  
1. **方法适用性**：  
   - 结果回归和倾向评分适用于简单固定治疗场景，但需严格满足可交换性、正性、一致性。  
   - 时变治疗需用 g-methods（IP 加权、标准化、g-估计）。  

2. **核心局限**：  
   - **结果回归**：依赖 \(L-Y\) 模型正确性。  
   - **倾向评分**：匹配法导致目标人群不明确；分层法存在离散化偏倚。  
   - **变量选择**：因果推断中避免预测导向的变量筛选（可能引入偏倚/方差）。  

3. **实践建议**：  
   - 优先使用双稳健方法（doubly robust methods）。  
   - 确保倾向评分模型包含足够混杂因子，但避免无关变量。  
   - 用样条等灵活模型减少函数形式误设。  

> 注：所有结论严格基于文本，未添加主观内容。数学公式、技术术语（如 nuisance parameters, balancing score）保留英文以确保准确性。