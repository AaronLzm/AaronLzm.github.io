---
title: Chapter_6
category: Causal inference
tags: [DeepSeek-R1-0528-1st,response_md]

---
<think>
我们正在处理《因果推断：What If》第6章的内容。这一章主要介绍了因果效应的图形表示方法，特别是因果图（Causal Diagrams）的概念和应用。以下是本章的详细总结，严格按照章节结构组织，包括所有技术重点和细节要点，并保留必要的英文术语以确保准确性。

### 第6章：因果效应的图形表示
#### 6.1 因果图（Causal Diagrams）
- **核心概念**：因果图是一种有向无环图（Directed Acyclic Graph, DAG），用于表示变量间的因果关系。
- **节点（Nodes）**：代表随机变量（如治疗A、结果Y、协变量L）。
- **边（Edges）**：箭头表示直接因果效应（从原因指向结果）。例如，图6.1中：
  - L → A 表示疾病严重程度（L）影响心脏移植（A）的概率。
  - A → Y 表示心脏移植（A）影响死亡（Y）的风险。
  - L → Y 表示疾病严重程度（L）直接影响死亡（Y）的风险。
- **关键特性**：
  - **有向性（Directed）**：箭头方向表示因果方向（如L→A表示L可能导致A，但反之不成立）。
  - **无环性（Acyclic）**：图中无循环路径（即变量不能直接或间接导致自身）。
- **因果DAG的正式定义**（Technical Point 6.1）：
  - 一个因果DAG需满足：
    1. 缺失箭头表示无直接因果效应（相对图中其他变量）。
    2. 所有变量对的共同原因（即使未测量）均包含在图中。
    3. 任何变量是其后代的因。
  - **因果马尔可夫假设（Causal Markov Assumption）**：给定其直接原因（父节点），变量独立于其非后代变量。数学上，联合密度满足马尔可夫分解：
    $$
    f(v) = \prod_{j=1}^{M} f(v_j | \text{pa}_j)
    $$
    其中 \(\text{pa}_j\) 是 \(V_j\) 的父节点集合。
- **应用场景**：
  - 图6.1：表示条件随机实验（如A的概率依赖于L）或观察性研究（假设L是A和Y的唯一共同原因）。
  - 图6.2：表示边际随机实验（A的分配与L无关）。

#### 6.2 因果图与边际独立性
- **关联的来源**：两个变量A和Y在以下情况会边际关联：
  1. **直接因果效应**：A导致Y（图6.2）。
  2. **共同原因**：A和Y共享共同原因L（图6.3）。
- **碰撞点（Collider）阻塞关联**：若A和Y有共同效应L（路径A→L←Y），则A和Y边际独立（图6.4）。例如：
  - 单倍型A与吸烟Y均导致心脏病L，但A与Y无直接关联。
- **图形规则**：路径开放的条件（见Fine Point 6.1）：
  - 无碰撞点（非碰撞点）的路径允许关联流动。
  - 碰撞点（如L在A→L←Y中）会阻塞路径，除非对碰撞点或其后代进行条件调整。

#### 6.3 因果图与条件独立性
- **条件独立性的图形规则**：
  - **中介变量**：若A通过B影响Y（A→B→Y），则条件化B会阻断A与Y的关联（图6.5），即 \(A \perp\!\!\!\perp Y | B\)。
  - **共同原因**：若L是A和Y的共同原因（A←L→Y），则条件化L会阻断关联（图6.6），即 \(A \perp\!\!\!\perp Y | L\)。
  - **共同效应（碰撞点）**：条件化碰撞点L（A→L←Y）或其后代C会打开路径，导致A与Y条件关联（图6.7-6.8）。
- **d-分离（d-separation）**（Fine Point 6.1）：
  - 路径被阻断的条件：
    1. 路径包含非碰撞点且被条件化。
    2. 路径包含未条件化且无后代被条件化的碰撞点。
  - 若所有路径被阻断，则变量条件独立（d-分离）。

#### 6.4 正性与一致性在因果图中
- **正性（Positivity）**：图中通常隐含正性（除非治疗A是预处理变量L的确定性函数，此时用粗箭头L→A表示）。
- **一致性（Consistency）**：治疗节点A的干预需明确定义（箭头A→Y对应明确的干预）。
- **治疗节点的特殊性**：与其他节点不同，治疗节点需对应充分定义的干预（如“减肥”需明确干预方式，图6.10）。

#### 6.5 偏倚的结构分类
- **系统偏倚（Systematic Bias）**：在无限样本下仍存在的偏倚，源于非因果关联。
- **偏倚来源**：
  1. **混杂（Confounding）**：治疗与结果有共同原因（如L在图6.1中导致A与Y关联）。
  2. **选择偏倚（Selection Bias）**：条件化共同效应（如碰撞点L在图6.7中引入关联）。
  3. **测量偏倚（Measurement Bias）**：变量测量误差（第9章详述）。
- **零偏倚（Bias Under the Null）**：即使无因果效应（如 \(Pr[Y^a=1] = Pr[Y^{a'}=1]\)），关联仍存在（如表3.1中关联风险比≠1）。

#### 6.6 效应修饰的结构
- **效应修饰（Effect Modification）**：因果图不直接表示效应修饰的异质性（如方向或强度变化）。
- **类型**：
  - **因果效应修饰**：变量V直接影响Y（图6.12），且修饰A对Y的效应。
  - **代理效应修饰**：变量S与V关联（通过共同原因、共同效应或因果路径，图6.14-6.16），但本身不直接影响Y。
- **图形限制**：标准DAG不区分效应修饰的定性类型（如定性修饰或仅部分层有效应）。

### 结论
- **因果图的作用**：直观表示因果假设，辅助识别关联来源（因果、混杂、选择偏倚），并指导数据分析（如选择调整变量）。
- **与反事实理论的联系**：因果图对应潜在结果模型（如NPSEM-IE或FFRCISTG，见Technical Point 6.2-6.3），SWIG图（第7章）将统一两者。
- **关键局限**：不直接编码正性、效应修饰异质性，且需谨慎定义治疗干预。

### 数学公式
- **马尔可夫分解**：
  $$
  f(v) = \prod_{j=1}^{M} f(v_j | \text{pa}_j)
  $$
- **d-分离规则**：见Fine Point 6.1的4条规则。

本章为后续讨论混杂（第7章）、选择偏倚（第8章）和测量偏倚（第9章）奠定基础。
</think>
### 第6章：因果效应的图形表示  
**核心目标**：引入因果图（Causal Diagrams）作为工具，直观表示因果结构和假设，解决复杂场景中的因果推断问题。  

---

#### **6.1 因果图（Causal Diagrams）**  
**技术重点**：  
1. **定义与结构**：  
   - **因果图**是有向无环图（Directed Acyclic Graph, DAG），节点（Nodes）表示随机变量（如治疗 \(A\)、结局 \(Y\)、协变量 \(L\)），边（Edges）表示直接因果效应。  
   - **关键特性**：  
     - *有向性*：箭头方向表示因果方向（如 \(L \to A\) 表示 \(L\) 可能引起 \(A\)）。  
     - *无环性*：无循环路径（变量不能直接或间接导致自身）。  
   - **示例**（图6.1）：  
     - 变量：\(L\)（疾病严重程度）、\(A\)（心脏移植）、\(Y\)（死亡）。  
     - 路径：\(L \to A\)（疾病影响移植概率），\(A \to Y\)（移植影响死亡），\(L \to Y\)（疾病直接影响死亡）。  

2. **因果DAG的正式定义**（Technical Point 6.1）：  
   - **因果马尔可夫假设（Causal Markov Assumption）**：给定直接原因（父节点），变量独立于其非后代。  
   - **联合密度分解**：  
     $$
     f(v) = \prod_{j=1}^{M} f(v_j | \text{pa}_j)
     $$
     其中 \(\text{pa}_j\) 是 \(V_j\) 的父节点集合。  
   - **因果DAG三条件**：  
     1. 缺失箭头 \(\Rightarrow\) 无直接因果效应。  
     2. 所有共同原因（含未测量变量）需包含在图中。  
     3. 变量是其后代的因。  

3. **应用场景**：  
   - **观察性研究**（图6.1）：需假设 \(L\) 是 \(A\) 和 \(Y\) 的唯一共同原因（对应条件可交换性 \(Y^a \perp\!\!\!\perp A \mid L\)）。  
   - **随机实验**（图6.2）：若 \(A\) 的分配与 \(L\) 无关（边际随机），则无需包含 \(L\)。  

---

#### **6.2 因果图与边际独立性**  
**技术重点**：  
1. **关联来源**：  
   - **直接因果**：\(A \to Y\) 导致关联（图6.2）。  
   - **共同原因**：\(A \leftarrow L \to Y\) 导致关联（图6.3）。  
   - **共同效应（碰撞点 Collider）**：路径 \(A \to L \leftarrow Y\) 被阻塞，\(A\) 与 \(Y\) 边际独立（图6.4）。  

2. **图形规则**：  
   - **路径开放条件**：无碰撞点或碰撞点未被条件化。  
   - **示例**：  
     - 吸烟（\(L\)）是携带打火机（\(A\)）和肺癌（\(Y\)）的共同原因 \(\Rightarrow A\) 与 \(Y\) 关联。  
     - 单倍型（\(A\)）与吸烟（\(Y\)）共同导致心脏病（\(L\)，碰撞点）\(\Rightarrow A\) 与 \(Y\) 独立。  

---

#### **6.3 因果图与条件独立性**  
**技术重点**：  
1. **条件化影响**：  
   - **中介变量**：条件化 \(B\)（如血小板聚集）阻断路径 \(A \to B \to Y\)，导致 \(A \perp\!\!\!\perp Y \mid B\)（图6.5）。  
   - **共同原因**：条件化 \(L\)（如吸烟）阻断 \(A \leftarrow L \to Y\)，导致 \(A \perp\!\!\!\perp Y \mid L\)（图6.6）。  
   - **碰撞点**：条件化 \(L\)（如心脏病）打开路径 \(A \to L \leftarrow Y\)，导致 \(A\) 与 \(Y\) 条件关联（图6.7）。  

2. **d-分离规则**（Fine Point 6.1）：  
   - **路径阻断条件**：  
     1. 含非碰撞点且被条件化。  
     2. 含未条件化且无后代被条件化的碰撞点。  
   - **定理**：若 \(A\) 与 \(Y\) d-分离给定 \(C\)，则 \(A \perp\!\!\!\perp Y \mid C\)（需因果马尔可夫假设）。  

---

#### **6.4 正性与一致性在因果图中**  
**技术重点**：  
1. **隐含假设**：  
   - **正性（Positivity）**：图中默认成立（除非箭头 \(L \to A\) 为粗体，表示 \(A\) 是 \(L\) 的确定性函数）。  
   - **一致性（Consistency）**：治疗节点 \(A\) 需对应明确定义的干预（如“减肥”需指定具体方式，图6.10）。  
2. **治疗节点的特殊性**：  
   - 与其他节点区分，需确保干预的明确性（如“肥胖”不宜作为治疗节点）。  

---

#### **6.5 偏倚的结构分类**  
**技术重点**：  
1. **系统偏倚（Systematic Bias）**：  
   - **来源**：  
     - **混杂（Confounding）**：共同原因导致关联（如 \(L\) 影响 \(A\) 和 \(Y\)）。  
     - **选择偏倚（Selection Bias）**：条件化共同效应（碰撞点）引入关联。  
     - **测量偏倚（Measurement Bias）**：变量误差（第9章）。  
   - **零偏倚（Bias Under the Null）**：即使无因果效应（\(Pr[Y^{a=1}] = Pr[Y^{a=0}]\)），仍存在关联（如表3.1）。  

---

#### **6.6 效应修饰的结构**  
**技术重点**：  
1. **效应修饰类型**：  
   - **因果效应修饰**：变量 \(V\)（如医疗质量）直接影响 \(Y\) 且修饰 \(A\) 的效应（图6.12）。  
   - **代理效应修饰**：变量 \(S\)（如治疗成本）与 \(V\) 关联，但本身不影响 \(Y\)（图6.14）。  
2. **图形局限性**：  
   - DAG不区分效应修饰的异质性（如效应方向或是否存在效应）。  
   - 代理修饰可通过共同原因（图6.15）或条件化（图6.16）关联真实修饰因子。  

---

### **结论**  
1. **因果图的核心作用**：  
   - 将因果假设可视化，辅助识别关联来源（直接因果、混杂、选择偏倚）。  
   - 通过d-分离规则推导条件独立性，指导数据分析（如选择调整变量）。  
2. **与反事实理论的联系**：  
   - 因果图对应潜在结果模型（如NPSEM-IE或FFRCISTG，见Technical Point 6.2–6.3）。  
   - SWIG图（第7章）将统一图形与反事实框架。  
3. **关键局限**：  
   - 未直接编码正性、效应修饰异质性。  
   - 治疗节点需明确定义干预，避免模糊性（如“减肥”需指定方式）。  

> **下一步**：第7章将深入讨论混杂偏倚的图形识别与调整方法。