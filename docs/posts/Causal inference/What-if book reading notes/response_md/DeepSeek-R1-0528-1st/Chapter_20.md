---
date: 2025-09-17 11:19:05
title: Chapter_20
category: Causal inference
tags: [DeepSeek-R1-0528-1st,response_md]

---
<think>
我们正在处理《因果推断：What If》第20章“治疗-混杂因素反馈”的内容。本章的核心是探讨在存在时间依赖性混杂因素且这些混杂因素受先前治疗影响时，传统调整方法（如分层、回归、匹配）为何会产生偏倚，并引入g-方法作为解决方案。

 根据要求，我们需要：
 1. 严格遵循章节结构，提炼所有技术重点和细节要点。
 2. 对数学公式使用LaTeX格式。
 3. 使用中文总结，但保留英文技术术语。
 4. 不添加主观臆断，确保信息完整。

 本章结构如下：
 20.1 治疗-混杂因素反馈的要素
 20.2 传统方法的偏倚
 20.3 传统方法为何失败
 20.4 为何传统方法无法修正
 20.5 调整过去的治疗

 此外，包含两个Fine Points和一个Technical Point。

 现在开始逐节提炼：

 20.1 治疗-混杂因素反馈的要素
 - 时间依赖性混杂（time-varying confounding）：在HIV研究例子中，每月记录治疗$A_k$（1:治疗,0:未治疗）和协变量$L_k$（如CD4细胞计数），结局$Y$在$K+1$月测量。
 - 治疗-混杂因素反馈（treatment-confounder feedback）：在因果图（Figure 20.1）中，存在$L_k \rightarrow A_k$（混杂因素影响治疗）和$A_{k-1} \rightarrow L_k$（治疗影响混杂因素）的双向路径，形成反馈。
 - 反馈循环的表示：使用无环图（acyclic graphs）表示反馈循环的技巧是将时间离散化（如按月），通过$A_{k-1} \rightarrow L_k \rightarrow A_k \rightarrow L_{k+1}$等路径表示循环。
 - 时间离散化（discretization of time）是可行的，因为实际研究中时间通常以月、天等离散单位测量。
 - 无反馈的时间依赖性混杂：Figure 20.2删除了$A_{k-1} \rightarrow L_k$的箭头，此时$L_k$仍是时间依赖性混杂因素，但不受先前治疗影响，故无反馈。
 - 简化因果图（Figure 20.3）：为简化讨论，考虑两个时间点（$k=0,1$），省略基线$L_0$、未测量变量$U_0$、$A_0$到$A_1$的箭头，并假设sharp null hypothesis（治疗无任何个体效应）。该图保留了反馈的核心结构：$A_0 \rightarrow L_1 \leftarrow U_1$且$L_1 \rightarrow A_1$，但无路径指向$Y$（效应为0）。

 20.2 传统方法的偏倚
 - 问题：即使满足序贯可交换性（sequential exchangeability），传统方法调整混杂因素$L_1$仍会引入偏倚。
 - 模拟试验：32,000名HIV患者，两个时间点，$A_0$随机分配（概率0.5），$A_1$依$L_1$分配（$L_1=0$时概率0.4，$L_1=1$时概率0.8）。结局$Y$值越大表示健康越好。
 - 数据（Table 20.1）：按$(A_0, L_1, A_1)$组合分组，给出每组人数$N$和$E[Y|A_0,L_1,A_1]$。
 - 可识别条件：序贯可交换性（sequential exchangeability）、正值性（positivity）、一致性（consistency）均满足。
 - 验证零效应：在Figure 20.3（sharp null）下，应无任何效应。
   - $A_1$的效应：在$(A_0, L_1)$四层中，$E[Y|A_1=1]-E[Y|A_1=0]=0$（如$A_0=0,L_1=0$层：84-84=0）。
   - $A_0$的效应：$E[Y|A_0=1]-E[Y|A_0=0]=60-60=0$。
   - 联合策略效应：根据g-null定理（Technical Point 20.1），若所有时间固定治疗条件效应为零，则任何策略效应为零，即$E[Y^{a_0=1,a_1=1}]-E[Y^{a_0=0,a_1=0}]=0$。
 - 传统方法分析：
   - 未调整$L_1$：比较"始终治疗"$(A_0=1,A_1=1)$ vs "从不治疗"$(A_0=0,A_1=0)$，得$E[Y|A_0=1,A_1=1]=54.7$，$E[Y|A_0=0,A_1=0]=68$，差异$-13.3$（错误，需调整$L_1$）。
   - 调整$L_1$（分层）：在$L_1=0$层，$E[Y|A_0=1,L_1=0,A_1=1]-E[Y|A_0=0,L_1=0,A_1=0]=76-84=-8$；$L_1=1$层同样得$-8$。加权平均仍为$-8 \neq 0$，仍错误。

 20.3 传统方法为何失败
 - 根本原因：在存在治疗-混杂因素反馈时，分层法调整$L_1$（混杂因素）会引入选择偏倚（selection bias）。
 - 机制：在Figure 20.5中，$L_1$是$A_0 \rightarrow L_1 \leftarrow U_1$的碰撞子（collider），调整$L_1$（即条件化）会打开路径$A_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$，导致$A_0$与$Y$出现非因果关联。
   - 在$L_1=1$（低CD4）层，$A_0=1$（治疗）与高$U_1$（免疫抑制）相关，而$U_1$降低$Y$。
   - 在$L_1=0$（高CD4）层，$A_0=0$（未治疗）与低$U_1$相关，而$U_1$升高$Y$。
 - 后果：分层消除了$A_1$的混杂，但为$A_0$引入了选择偏倚。关联差异$E[Y|A_0=1,L_1=l,A_1=1]-E[Y|A_0=0,L_1=l,A_1=0]$可能非零，即使真实效应为零。
 - 扩展：
   - 观察性研究（Figure 20.6）：若$L_1$与$A_0$有共同原因$W_0$，调整$L_1$会打开路径$A_0 \leftarrow W_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$，同样导致偏倚。
   - 非零效应场景（Figure 20.7）：即使治疗有真实效应（如$A_0 \rightarrow Y$），调整$L_1$仍会引入$A_0$与$Y$的非因果关联。
   - 高维数据：多个时间点时偏倚可能更大。

 20.4 为何传统方法无法修正
 - 回归模型的失败：即使使用参数模型（如线性回归）替代非参数分层，仍无法解决偏倚。
   - 例：定义累积治疗$\text{cum}(\bar{A}) = A_0 + A_1$，拟合模型$E[Y|\bar{A},L_1] = \theta_0 + \theta_1 \text{cum}(\bar{A}) + \theta_2 L_1$。
   - 关联差$E[Y|\text{cum}(\bar{A})=2,L_1] - E[Y|\text{cum}(\bar{A})=0,L_1] = 2\theta_1$，但条件化$L_1$仍诱导$A_0$与$Y$的非因果关联，导致$\theta_1 \neq 0$（即使真实效应为0）。
 - 核心问题：传统方法（分层、回归、匹配）本质都是基于条件化混杂因素，无法处理治疗-混杂因素反馈。需用g-方法（g-methods）。

 20.5 调整过去的治疗
 - 一般情况：过去治疗$A_0$可能直接影响后续治疗$A_1$（如医生依据治疗史决策），需在因果图中添加$A_0 \rightarrow A_1$（Figures 20.8, 20.9）。
 - 混杂调整：在反馈存在时，仅调整$L_1$不足以阻断$A_1$到$Y$的后门路径（如Figure 20.8中$A_1 \leftarrow A_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$）。
 - 序贯可交换性要求：必须同时调整治疗史$\bar{A}_{k-1}$和协变量$L$（如$Y^{a_k} \perp \!\!\! \perp A_k | \bar{A}_{k-1}, \bar{L}_k$）。
 - 时间固定治疗的推断：若关注$A_1$的效应（短期效应），未调整$A_0$会导致：
   - 选择偏倚（若存在反馈）。
   - 混杂（若$A_0$直接影响$Y$）。
 - 新使用者设计（new-user designs）：限制分析为既往未治疗者，以避免调整过去治疗。
 - 过去治疗的测量误差：若$A_0$存在测量误差（如问卷回忆偏差），即使误差独立且非差异，仍会导致：
   - 零效应下出现偏倚（Robins 1987：可能远离零）。
   - 非零效应时高估效应。
  技术点与细节要点：
  - Fine Point 20.1：用无环图表示反馈循环。通过时间分解循环，要求时间离散化。
  - Technical Point 20.1：g-null检验。若sharp null成立（所有个体所有策略下$Y^g=Y$），则序贯可交换性蕴含条件独立$Y \perp \!\!\! \perp A_0 | L_0$和$Y \perp \!\!\! \perp A_1 | A_0, L_0, L_1$。检验这些独立性即g-null检验（Robins 1986）。g-null定理：若序贯随机化对所有策略成立，则上述独立性等价于所有策略的$E[Y^g]$相同且等于观测$E[Y]$。
  - Fine Point 20.2：因果路径上的混杂因素。即使混杂因素$L_1$在$A_0$到$Y$的因果路径上（如Figure 20.7的$A_0 \rightarrow L_1 \rightarrow Y$），调整$L_1$仍会引入偏倚（传统方法）。但g-方法可无偏调整。

 结论：
 - 治疗-混杂因素反馈存在时，传统混杂调整方法（分层、回归、匹配）会产生偏倚，即使满足可识别条件。
 - 偏倚源于条件化受先前治疗影响的混杂因素（或与其共享原因），这会打开非因果路径。
 - g-方法（如g-formula, IPTW, g-estimation）可正确处理此问题。
 - 需调整过去治疗史，其测量误差也会导致偏倚。
</think>
### 第20章：治疗-混杂因素反馈（TREATMENT-CONFOUNDER FEEDBACK）总结

#### **20.1 治疗-混杂因素反馈的要素**
- **核心问题**：当时间依赖性混杂因素（time-varying confounders）受先前治疗影响时，传统调整方法（如分层、回归）会产生偏倚，即使满足序贯可交换性（sequential exchangeability）。
- **因果图结构**：
  - **反馈存在**（图20.1, 20.3）：  
    - 路径：$A_{k-1} \rightarrow L_k \rightarrow A_k$（治疗影响混杂因素，混杂因素影响后续治疗）。  
    - 例：HIV研究中，治疗$A_k$（抗病毒药物）影响CD4计数$L_k$，而$L_k$又影响后续治疗决策，形成反馈循环。
  - **无反馈**（图20.2）：$L_k$是时间依赖性混杂因素，但不受先前治疗影响（无$A_{k-1} \rightarrow L_k$）。
- **反馈的图形表示**：
  - 用**无环图**（acyclic graphs）表示反馈循环：离散化时间区间（如月份），通过路径$A_{k-1} \rightarrow L_k \rightarrow A_k \rightarrow L_{k+1}$刻画动态过程（Fine Point 20.1）。
  - 时间离散化（discretization of time）是可行的（如按天/月/年），且与实际数据收集一致。
- **简化模型**（图20.3）：
  - 省略基线变量$L_0$、未测量变量$U_0$，假设无$A_0 \rightarrow A_1$，且**sharp null hypothesis**成立（治疗无因果效应）。
  - 核心结构保留：$A_0 \rightarrow L_1 \leftarrow U_1$ 和 $L_1 \rightarrow A_1$，无路径指向结局$Y$（真实效应为0）。

---

#### **20.2 传统方法的偏倚**
- **模拟试验**（表20.1）：
  - 32,000名HIV患者，两时间点（$k=0,1$），$A_0$随机分配（$P=0.5$），$A_1$依$L_1$（CD4计数）分配（$L_1=0$时$P=0.4$；$L_1=1$时$P=0.8$）。
  - 可识别条件满足：序贯可交换性、正值性（positivity）、一致性（consistency）。
- **验证零效应**：
  - $A_1$的层别效应为零（e.g., $E[Y|A_0=0,L_1=0,A_1=1] - E[Y|A_0=0,L_1=0,A_1=0] = 84-84=0$）。
  - $A_0$的边际效应为零（$E[Y|A_0=1] = E[Y|A_0=0] = 60$）。
  - **g-null定理**（Technical Point 20.1）：若所有治疗条件效应为零，则策略效应$E[Y^{a_0=1,a_1=1}] - E[Y^{a_0=0,a_1=0}]$应为0。
- **传统方法失败**：
  1. **未调整$L_1$**：  
     $E[Y|A_0=1,A_1=1] = 54.7$，$E[Y|A_0=0,A_1=0] = 68$，差异为$-13.3$（错误推断"从不治疗更优"）。
  2. **调整$L_1$（分层）**：  
     在$L_1=0$层：$76 - 84 = -8$；在$L_1=1$层：$44 - 52 = -8$，加权平均仍为$-8 \neq 0$。

---

#### **20.3 传统方法为何失败**
- **根本原因**：调整受治疗影响的混杂因素$L_1$会引入**选择偏倚**（selection bias）。
- **机制**（图20.5）：
  - $L_1$是碰撞子（collider）：条件化$L_1$打开非因果路径$A_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$。
  - 例：在$L_1=1$（低CD4）层，$A_0=1$与高$U_1$（免疫抑制）相关，导致$Y$降低。
- **扩展场景**：
  - **观察性研究**（图20.6）：$L_1$与$A_0$有共享因$W_0$，条件化$L_1$打开路径$A_0 \leftarrow W_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$。
  - **非零效应**（图20.7）：即使存在真实效应（$A_0 \rightarrow Y$），调整$L_1$仍引入偏倚（Fine Point 20.2）。
- **关键结论**：  
  传统方法消除$A_1$的混杂，但以引入$A_0$的选择偏倚为代价，且偏倚在高维数据中更严重。

---

#### **20.4 为何传统方法无法修正**
- **回归模型同样失效**：
  - 例：拟合累积治疗模型$\text{cum}(\bar{A}) = A_0 + A_1$：  
    $$E[Y|\bar{A},L_1] = \theta_0 + \theta_1 \text{cum}(\bar{A}) + \theta_2 L_1$$
  - 关联差$E[Y|\text{cum}(\bar{A})=2,L_1] - E[Y|\text{cum}(\bar{A})=0,L_1] = 2\theta_1$，但因条件化$L_1$，$\theta_1 \neq 0$（真实效应为0）。
- **高维挑战**：  
  当时间点$K$较大（e.g., $K=100$），静态策略数达$2^{100}$，远超样本量，需建模剂量-反应关系，但无法解决反馈偏倚。
- **核心限制**：  
  传统方法（分层、回归、匹配）本质依赖条件化混杂因素，无法处理治疗-混杂反馈，必须使用**g-方法**（g-methods）。

---

#### **20.5 调整过去的治疗**
- **一般化因果图**（图20.8–20.10）：
  - 添加$A_0 \rightarrow A_1$路径（过去治疗影响后续治疗）。
  - 条件化$L_1$不足：打开路径如$A_1 \leftarrow A_0 \rightarrow L_1 \leftarrow U_1 \rightarrow Y$。
- **序贯可交换性要求**：  
  必须同时调整**治疗史**$\bar{A}_{k-1}$和协变量$\bar{L}_k$（e.g., $Y^{a_k} \perp\!\!\!\perp A_k \mid \bar{A}_{k-1}, \bar{L}_k$）。
- **时间固定治疗的偏倚**：
  - 未调整$A_0$导致选择偏倚（反馈存在时）或混杂（$A_0$直接影响$Y$时）。
  - **新使用者设计**（new-user designs）：限制分析于既往未治疗者，避免调整过去治疗。
- **治疗史测量误差**：
  - 若$A_0$存在误差（e.g., 问卷回忆偏差），即使误差独立，仍导致：
    - 零效应下出现偏倚（可能远离零）。
    - 非零效应时高估效应（Robins (1987)）。

---

### **关键结论**
1. **治疗-混杂反馈**：当时间依赖性混杂因素受先前治疗影响（或与其共享原因）时，传统调整方法必然引入偏倚。
2. **g-方法必要性**：仅g-方法（如g-formula、IPTW、g-estimation）可无偏估计因果效应。
3. **调整要求**：必须同时考虑治疗史和协变量，且治疗史测量误差会加剧偏倚。
4. **图形验证**：因果图（如DAGs）是诊断反馈和偏倚来源的核心工具。

> **公式与术语**  
> - 序贯可交换性：$Y^{\bar{a}} \perp\!\!\!\perp A_k \mid \bar{A}_{k-1}, \bar{L}_k$  
> - g-null定理：若sharp null成立，则$Y \perp\!\!\!\perp A_0 \mid L_0$ 且 $Y \perp\!\!\!\perp A_1 \mid A_0, L_0, L_1$  
> - 碰撞子偏倚：条件化$L_1$（$A_0 \rightarrow L_1 \leftarrow U_1$) 打开非因果路径