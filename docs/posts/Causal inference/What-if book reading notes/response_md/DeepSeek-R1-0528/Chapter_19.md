---
date: 2025-09-17 11:19:05
title: Chapter_19
category: Causal inference
tags: [DeepSeek-R1-0528,response_md]

---
<think>
我们正在处理第19章“时变处理”的内容。本章介绍了时变处理的基本概念、处理策略、序贯随机实验、序贯可交换性以及时变混杂等重要主题。

 由于用户提供了PDF提取的文本和图像列表，但图像内容无法直接解析，我们将主要依赖文本内容进行总结。对于图像，我们将根据上下文描述其内容，并在必要时标注“需进一步查证”。

 本章结构：
 19.1 时变处理的因果效应
 19.2 处理策略
 19.3 序贯随机实验
 19.4 序贯可交换性
 19.5 部分处理策略下的可识别性
 19.6 时变混杂和时变混杂因素

 我们将按照章节和子章节逐步总结，提炼技术重点和细节要点。

 注意：数学公式使用LaTeX格式，用$$包裹。
</think>
### 第19章 时变处理（TIME-VARYING TREATMENTS）

#### 章节概览
本章引入时变处理（随时间变化的干预）的因果推断框架，对比时固定处理的差异，定义处理策略（treatment strategies）、序贯可交换性（sequential exchangeability）等核心概念，并通过因果图（如SWIGs）分析可识别性条件。HIV治疗案例贯穿全章，说明抗逆转录病毒疗法的动态决策问题。

---

### 19.1 时变处理的因果效应
**技术重点（Technical Points）**：
- **核心理论**：  
  时变处理 \(A_k\) 在随访时间点 \(k = 0,1,\dots,K\)（如每月）变化，需通过处理策略定义因果效应。时固定处理（如单时间点干预）的因果效应定义为：  
  $$E[Y^{a=1}] - E[Y^{a=0}]$$  
  但此定义不适用于时变处理，因其需考虑整个处理历史 \(\bar{A} = (A_0, A_1, \dots, A_K)\)。
- **关键公式**：  
  处理历史记为 \(\bar{A}_k = (A_0, A_1, \dots, A_k)\)，完整历史 \(\bar{A} = \bar{A}_K\)。例如：
  - "始终治疗"策略：\(\bar{A} = \bar{1} = (1,1,\dots,1)\)
  - "从不治疗"策略：\(\bar{A} = \bar{0} = (0,0,\dots,0)\)
- **重要概念**：  
  时变处理的因果效应需通过对比**处理策略**（如 \(\bar{1}\) vs \(\bar{0}\)) 定义，而非单时间点对比 \(E[Y^{a_k=1}] - E[Y^{a_k=0}]\)。
- **应用场景**：  
  HIV患者抗逆转录病毒疗法的动态决策（治疗依CD4细胞计数调整）。

**细节要点（Fine Points）**：
- **简化假设**：暂不考虑失访、死亡或测量误差。
- **时间索引**：采用从0开始的索引（\(k=0\)为起点），与文献一致。
- **案例细节**：  
  \(Y\) 在 \(K+1=60\) 个月时测量（健康状态，值越大越健康）。

---

### 19.2 处理策略
**技术重点（Technical Points）**：
- **核心理论**：  
  处理策略 \(g\) 是随时间分配处理的规则，分为：
  - **静态策略（static strategy）**：处理分配仅依赖时间，如 \(\bar{a} = (1,0,1,0,\dots)\)。
  - **动态策略（dynamic strategy）**：处理分配依赖时变协变量，如 "当 \(L_k=1\)（CD4低）时治疗"。
- **重要概念**：  
  - 因果效应定义为策略对比：如 \(E[Y^{\bar{a}}] - E[Y^{\bar{a}'}]\) 或 \(E[Y^{\bar{a}}] - E[Y^g]\)。
  - 策略数量：二值处理时有 \(2^K\) 种静态策略，动态策略数量更多（依赖 \(L_k\) 演化）。
- **应用场景**：  
  HIV治疗中基于CD4细胞计数的动态治疗规则。

**细节要点（Fine Points）**：
- **策略类型**（Fine Point 19.1）：
  - **确定性策略（deterministic）**：分配固定处理值（如 \(g_k(\cdot) = 0/1\)）。
  - **随机策略（random）**：分配处理概率（如 "每月以概率0.3治疗"）。
- **最优策略**：最大化 \(E[Y^g]\) 的策略，通常为动态策略（如药物毒性需停药时）。
- **符号规范**：  
  \(Y^g\) 表示遵循策略 \(g\) 的反事实结果；静态策略可写为 \(Y^{\bar{a}}\)。

---

### 19.3 序贯随机实验
**技术重点（Technical Points）**：
- **核心理论**：  
  序贯随机实验中，处理 \(A_k\) 的分配概率仅依赖**已测**历史 \((\bar{A}_{k-1}, \bar{L}_k)\)，无未测混杂（图19.2）。
- **重要概念**：  
  - 图19.1–19.3的因果图区别：
    - 图19.1：\(A_k\) 仅依赖前处理（无协变量影响），无混杂。
    - 图19.2：\(A_k\) 依赖已测协变量，**无未测混杂**（可识别 \(E[Y^g]\)）。
    - 图19.3：\(A_k\) 依赖未测变量，**存在未测混杂**（不可识别 \(E[Y^g]\)）。
  - 观察性研究通常对应图19.2或19.3。
- **应用场景**：  
  HIV观察性研究中，治疗决策依赖CD4计数（已测） vs. 免疫损伤（未测）。

**细节要点（Fine Points）**：
- **实验设计**：  
  例如，\(A_k\) 分配概率：
  - 若 \(A_{k-1}=0, L_k=1\)（未治且CD4高）：\(P(A_k=1)=0.4\)
  - 若 \(A_{k-1}=0, L_k=0\)（未治且CD4低）：\(P(A_k=1)=0.8\)
  - 若 \(A_{k-1}=1\)（已治）：\(P(A_k=1)=0.5\)
- **可识别性关键**：  
  图19.4存在未测 \(W_0\) 时，静态策略 \(E[Y^{\bar{a}}]\) 可识别，动态策略 \(E[Y^g]\) 不可识别。

---

### 19.4 序贯可交换性
**技术重点（Technical Points）**：
- **核心理论**：  
  时变处理的因果识别需**序贯可交换性**（sequential exchangeability）：  
  $$Y^g \perp\!\!\!\perp A_k \mid \bar{A}_{k-1} = g(\bar{A}_{k-2}, \bar{L}_{k-1}), \bar{L}_k \quad \forall k, g$$
- **关键公式**：  
  在序贯随机实验（图19.2）下，反事实均值 \(E[Y^g]\) 可通过g-公式（g-formula）、IP加权等方法识别。
- **重要概念**：  
  - 需同时满足**序贯正值性**（positivity）和**一致性**（consistency）（Technical Point 19.2）。
  - 静态策略可交换性（较弱）：\(Y^{\bar{a}} \perp\!\!\!\perp A_k \mid \bar{A}_{k-1} = \bar{a}_{k-1}, \bar{L}_k\)。
- **应用场景**：  
  调整时变协变量（如CD4计数）以估计HIV治疗策略效果。

**细节要点（Fine Points）**：
- **正值性条件**：  
  $$f_{A_k | \bar{A}_{k-1}, \bar{L}_k}(a_k | \bar{a}_{k-1}, \bar{l}_k) > 0 \quad \text{若} \quad f_{\bar{A}_{k-1}, \bar{L}_k}(\bar{a}_{k-1}, \bar{l}_k) \neq 0$$
- **一致性条件**（Technical Point 19.2）：  
  - 若个体实际处理符合策略 \(g\)，则 \(Y^g = Y\)（观测结果）。
  - 反事实协变量：\(\bar{L}^{\bar{a}}_k = \bar{L}_k\) 若 \(\bar{A}_{k-1} = \bar{a}_{k-1}\)。

---

### 19.5 部分处理策略下的可识别性
**技术重点（Technical Points）**：
- **核心理论**：  
  使用SWIGs（单例干预图）检验可识别性：
  - 图19.5（无未测混杂）：静态与动态策略均**可识别**（图19.7, 19.9）。
  - 图19.6（存在 \(W_0\)）：仅静态策略**可识别**（图19.8），动态策略不可识别（图19.10）。
- **重要概念**：  
  - **广义后门准则**（generalized backdoor criterion）：阻塞所有指向 \(A_k\) 的后门路径（不通过未来处理）。
  - 动态策略在SWIG中引入额外箭头（如 \(L^g_1 \to g_1(L^g_1)\)），影响可识别性。
- **应用场景**：  
  观察性研究中动态策略（如依CD4计数治疗）的可识别性依赖混杂结构。

**细节要点（Fine Points）**：
- **SWIGs解析**（Fine Point 19.2）：  
  - 干预节点（如 \(a_0\)）为常量，路径中隐含条件。
  - 动态策略中，需检查路径如 \(A_0 \leftarrow W_0 \to L^g_1 \to g_1) \to Y^g\)（图19.10）。
- **反例**（图19.11）：若 \(L_1\) 直接影响 \(Y\)，则所有策略均**不可识别**（图19.12）。

---

### 19.6 时变混杂和时变混杂因素
**技术重点（Technical Points）**：
- **核心理论**：  
  **时变混杂**（time-varying confounding）指需调整时变协变量 \(\bar{L}_k\) 以阻断后门路径（如 \(A_k \leftarrow L_k \leftarrow U \to Y\)）。
- **重要概念**：  
  - 混杂因素不必是结果的直接原因（如图19.5中 \(L_1\) 无指向 \(Y\) 的箭头）。
  - "无时变混杂"的条件：无条件序贯可交换性 \(Y^{\bar{a}} \perp\!\!\!\perp A_k \mid \bar{A}_{k-1} = \bar{a}_{k-1}\)（图19.1）。
- **应用场景**：  
  HIV研究中，CD4计数是时变混杂因素（影响治疗且与未测免疫损伤相关）。

**细节要点（Fine Points）**：
- **混杂定义**（Fine Point 19.3）：  
  - 若 \(E[Y^{\bar{a}}] \neq E[Y \mid A = \bar{a}]\) 则存在混杂。
  - 若 \(E[Y^{\bar{a}} \mid L_0] \neq E[Y \mid A = \bar{a}, L_0]\) 则存在时变混杂。
- **实践挑战**：  
  无法实证验证是否所有混杂已测量（图19.2 vs 图19.3），需依赖领域知识（如测量CD4、病毒载量）。

---

### 关键图表总结（基于上下文描述）
| **图号** | **描述**                                                                 | **可识别性结论**                                                                 |
|----------|--------------------------------------------------------------------------|--------------------------------------------------------------------------------|
| 19.1     | \(A_k\) 仅依赖前处理（无协变量影响）                                        | 静态策略 \(E[Y^{\bar{a}}] = E[Y \mid \bar{A} = \bar{a}]\)                     |
| 19.2     | \(A_k\) 依赖已测协变量（无未测混杂）                                        | 所有策略 \(E[Y^g]\) 可识别                                                     |
| 19.3     | \(A_k\) 依赖未测变量                                                      | 所有策略不可识别                                                               |
| 19.4     | 存在未测 \(W_0\)（影响 \(A_0\) 和 \(L_1\))                                 | 仅静态策略可识别                                                               |
| 19.5     | 简化图（无 \(L_0\), \(A_0 \to U_1\)，\(L_1\) 不直接影响 \(Y\))             | 静态策略可识别                                                                 |
| 19.6     | 简化图含 \(W_0\)（\(A_0\) 和 \(L_1\) 的共因）                              | 仅静态策略可识别                                                               |
| 19.7     | 图19.5的SWIG（静态策略）                                                  | 验证 \(Y^{a_0,a_1} \perp\!\!\!\perp A_k \mid \bar{A}_{k-1} = \bar{a}_{k-1}, \bar{L}_k\) |
| 19.10    | 图19.6的SWIG（动态策略）                                                  | 路径 \(A_0 \leftarrow W_0 \to L^g_1 \to Y^g\) 导致不可识别                      |

> **注**：图像内容需结合原书进一步查证，此处描述基于文本推导。

---

### 逻辑关联性
本章扩展了前两部分（时固定处理）的框架，引入时间维度，为后续g-方法（第21章）奠定基础。核心挑战是处理策略的因果定义和时变混杂的调整，需结合因果图（DAGs/SWIGs）严格分析可识别性条件。