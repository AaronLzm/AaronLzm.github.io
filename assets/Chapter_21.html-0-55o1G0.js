import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,a as e,g as a,d as s,f as m,w as i,r,b as c}from"./app-DNiAfeJ7.js";const o={};function h(g,t){const n=r("think");return c(),p("div",null,[e(n,null,{default:i(()=>[...t[0]||(t[0]=[a(" We are summarizing Chapter 21: G-METHODS FOR TIME-VARYING TREATMENTS from the provided text. The chapter addresses the problem of bias in traditional methods for time-varying treatments due to treatment-confounder feedback and introduces g-methods (g-formula, IP weighting, g-estimation, and doubly-robust generalizations) as solutions. The chapter uses a sequentially randomized experiment dataset (Table 21.1) to demonstrate that g-methods yield the correct null effect estimate when traditional methods fail. ",-1),s("p",null,[a("The chapter is structured into sections:"),s("br"),a(" 21.1 The g-formula for time-varying treatments"),s("br"),a(" 21.2 IP weighting for time-varying treatments"),s("br"),a(" 21.3 A doubly robust estimator for time-varying treatments"),s("br"),a(" 21.4 G-estimation for time-varying treatments"),s("br"),a(" 21.5 Censoring is a time-varying treatment"),s("br"),a(" 21.6 The big g-formula")],-1),s("p",null,"We will summarize each section, including technical points and fine points, and present mathematical formulas in LaTeX. We must ensure no important details are omitted and that technical terms are kept in English while the summary is in Chinese.",-1),s("p",null,"Let's proceed step by step.",-1)])]),_:1}),t[1]||(t[1]=a(" ### 第21章总结：时变处理的G-方法 本章解决传统方法在存在**治疗-混杂因素反馈**（treatment-confounder feedback）的时变处理中的偏倚问题，引入三类**G-方法**（g-formula、IP加权、g-估计及其双重稳健推广）作为解决方案。所有方法均基于可识别性条件（序贯可交换性、正值性、一致性），并在模拟数据集（表21.1）中成功估计零效应（真实效应为0），而传统方法失败。 ",-1)),t[2]||(t[2]=s("hr",null,null,-1)),t[3]||(t[3]=s("h4",{id:"_21-1-时变处理的g-公式",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_21-1-时变处理的g-公式"},[s("span",null,[s("strong",null,"21.1 时变处理的G-公式")])])],-1)),t[4]||(t[4]=s("p",null,[s("strong",null,"核心思想"),a("：通过标准化协变量分布计算反事实均值 (E[Y^{\\bar{a}}])。"),s("br"),s("strong",null,"技术要点"),a("：")],-1)),t[5]||(t[5]=s("ol",null,[s("li",null,[s("p",null,[s("strong",null,"公式结构"),a("：")]),s("ul",null,[s("li",null,[a("对于时变处理 (\\bar{A} = (A_0, A_1, \\dots, A_K)) 和时变协变量 (\\bar{L})："),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mi",null,"E"),s("mo",{stretchy:"false"},"["),s("msup",null,[s("mi",null,"Y"),s("mover",{accent:"true"},[s("mi",null,"a"),s("mo",null,"ˉ")])]),s("mo",{stretchy:"false"},"]"),s("mo",null,"="),s("munder",null,[s("mo",null,"∑"),s("mover",{accent:"true"},[s("mi",null,"l"),s("mo",null,"ˉ")])]),s("mi",null,"E"),s("mo",{stretchy:"false"},"["),s("mi",null,"Y"),s("mo",null,"∣"),s("mover",{accent:"true"},[s("mi",null,"A"),s("mo",null,"ˉ")]),s("mo",null,"="),s("mover",{accent:"true"},[s("mi",null,"a"),s("mo",null,"ˉ")]),s("mo",{separator:"true"},","),s("mover",{accent:"true"},[s("mi",null,"L"),s("mo",null,"ˉ")]),s("mo",null,"="),s("mover",{accent:"true"},[s("mi",null,"l"),s("mo",null,"ˉ")]),s("mo",{stretchy:"false"},"]"),s("munderover",null,[s("mo",null,"∏"),s("mrow",null,[s("mi",null,"k"),s("mo",null,"="),s("mn",null,"0")]),s("mi",null,"K")]),s("mi",null,"f"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"l"),s("mi",null,"k")]),s("mo",null,"∣"),s("msub",null,[s("mover",{accent:"true"},[s("mi",null,"a"),s("mo",null,"ˉ")]),s("mrow",null,[s("mi",null,"k"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",{separator:"true"},","),s("msub",null,[s("mover",{accent:"true"},[s("mi",null,"l"),s("mo",null,"ˉ")]),s("mrow",null,[s("mi",null,"k"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"E[Y^{\\bar{a}}] = \\sum_{\\bar{l}} E[Y \\mid \\bar{A} = \\bar{a}, \\bar{L} = \\bar{l}] \\prod_{k=0}^K f(l_k \\mid \\bar{a}_{k-1}, \\bar{l}_{k-1}) ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0604em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E"),s("span",{class:"mopen"},"["),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8104em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord accent mtight"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.5678em"}},[s("span",{style:{top:"-2.7em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"mord mathnormal mtight"},"a")]),s("span",{style:{top:"-2.7em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"accent-body",style:{left:"-0.25em"}},[s("span",{class:"mord mtight"},"ˉ")])])])])])])])])])])])])])]),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"2.4479em","vertical-align":"-1.3979em"}}),s("span",{class:"mop op-limits"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.05em"}},[s("span",{style:{top:"-1.7521em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord accent mtight"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8312em"}},[s("span",{style:{top:"-2.7em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.01968em"}},"l")]),s("span",{style:{top:"-2.9634em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"accent-body",style:{left:"-0.1667em"}},[s("span",{class:"mord mtight"},"ˉ")])])])])])])])])]),s("span",{style:{top:"-3.05em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",null,[s("span",{class:"mop op-symbol large-op"},"∑")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.3979em"}},[s("span")])])])]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E"),s("span",{class:"mopen"},"["),s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"∣"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8201em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8201em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal"},"A")]),s("span",{style:{top:"-3.2523em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.1111em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0145em","vertical-align":"-0.1944em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.5678em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal"},"a")]),s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.25em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8201em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal"},"L")]),s("span",{style:{top:"-3.2523em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.2222em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"3.1304em","vertical-align":"-1.3021em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8312em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.01968em"}},"l")]),s("span",{style:{top:"-3.2634em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.1667em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mop op-limits"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.8283em"}},[s("span",{style:{top:"-1.8479em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03148em"}},"k"),s("span",{class:"mrel mtight"},"="),s("span",{class:"mord mtight"},"0")])])]),s("span",{style:{top:"-3.05em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",null,[s("span",{class:"mop op-symbol large-op"},"∏")])]),s("span",{style:{top:"-4.3em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.07153em"}},"K")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.3021em"}},[s("span")])])])]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.10764em"}},"f"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.01968em"}},"l"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0197em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03148em"}},"k")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"∣"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0812em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.5678em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal"},"a")]),s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.25em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03148em"}},"k"),s("span",{class:"mbin mtight"},"−"),s("span",{class:"mord mtight"},"1")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2083em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8312em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.01968em"}},"l")]),s("span",{style:{top:"-3.2634em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.1667em"}},[s("span",{class:"mord"},"ˉ")])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0197em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03148em"}},"k"),s("span",{class:"mbin mtight"},"−"),s("span",{class:"mord mtight"},"1")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2083em"}},[s("span")])])])])]),s("span",{class:"mclose"},")")])])])])]),a(" 其中 (\\bar{l}_{k-1}) 是截至时间 (k-1) 的协变量历史，求和遍历所有可能的 (\\bar{l}) 路径。")]),s("li",null,[s("strong",null,"关键区别"),a("：需条件于既往治疗和协变量历史（时固定处理无需此步骤）。")])])]),s("li",null,[s("p",null,[s("strong",null,"可计算性条件"),a("：")]),s("ul",null,[s("li",null,[s("strong",null,"正值性"),a("：若 (f(l_k \\mid \\bar{a}"),s("em",{"k-1":""},"{k-1}, \\bar{l}"),a(") > 0)，则需存在个体满足 ((\\bar{A} = \\bar{a}, \\bar{L} = \\bar{l}))。")])])]),s("li",null,[s("p",null,[s("strong",null,"应用示例"),a("（表21.1数据）：")]),s("ul",null,[s("li",null,[a('"从不治疗"策略（(a_0=0, a_1=0)）：'),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mover",{accent:"true"},[s("mi",null,"E"),s("mo",null,"^")]),s("mo",{stretchy:"false"},"["),s("msup",null,[s("mi",null,"Y"),s("mrow",null,[s("mn",null,"0"),s("mo",{separator:"true"},","),s("mn",null,"0")])]),s("mo",{stretchy:"false"},"]"),s("mo",null,"="),s("mn",null,"84"),s("mo",null,"×"),s("mn",null,"0.25"),s("mo",null,"+"),s("mn",null,"52"),s("mo",null,"×"),s("mn",null,"0.75"),s("mo",null,"="),s("mn",null,"60")]),s("annotation",{encoding:"application/x-tex"},"\\hat{E}[Y^{0,0}] = 84 \\times 0.25 + 52 \\times 0.75 = 60 ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1968em","vertical-align":"-0.25em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.9468em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E")]),s("span",{style:{top:"-3.2523em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.1667em"}},[s("span",{class:"mord"},"^")])])])])])]),s("span",{class:"mopen"},"["),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8641em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"0"),s("span",{class:"mpunct mtight"},","),s("span",{class:"mord mtight"},"0")])])])])])])])]),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"84"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"×"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"0.25"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"52"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"×"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6444em"}}),s("span",{class:"mord"},"0.75"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6444em"}}),s("span",{class:"mord"},"60")])])])])])]),s("li",null,[a('"始终治疗"策略（(a_0=1, a_1=1)）：'),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mover",{accent:"true"},[s("mi",null,"E"),s("mo",null,"^")]),s("mo",{stretchy:"false"},"["),s("msup",null,[s("mi",null,"Y"),s("mrow",null,[s("mn",null,"1"),s("mo",{separator:"true"},","),s("mn",null,"1")])]),s("mo",{stretchy:"false"},"]"),s("mo",null,"="),s("mn",null,"76"),s("mo",null,"×"),s("mn",null,"0.5"),s("mo",null,"+"),s("mn",null,"44"),s("mo",null,"×"),s("mn",null,"0.5"),s("mo",null,"="),s("mn",null,"60")]),s("annotation",{encoding:"application/x-tex"},"\\hat{E}[Y^{1,1}] = 76 \\times 0.5 + 44 \\times 0.5 = 60 ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1968em","vertical-align":"-0.25em"}}),s("span",{class:"mord accent"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.9468em"}},[s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E")]),s("span",{style:{top:"-3.2523em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"accent-body",style:{left:"-0.1667em"}},[s("span",{class:"mord"},"^")])])])])])]),s("span",{class:"mopen"},"["),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8641em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"1"),s("span",{class:"mpunct mtight"},","),s("span",{class:"mord mtight"},"1")])])])])])])])]),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"76"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"×"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"0.5"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),s("span",{class:"mord"},"44"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"×"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6444em"}}),s("span",{class:"mord"},"0.5"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6444em"}}),s("span",{class:"mord"},"60")])])])])]),a(" 因果效应估计值：(60 - 60 = 0)（正确）。")])])]),s("li",null,[s("p",null,[s("strong",null,"注意事项"),a("：")]),s("ul",null,[s("li",null,"必须包含所有混杂因子（如忽略 (L_1) 会丧失因果解释）。"),s("li",null,"即使整体公式有因果解释，其组分（如 (E[Y \\mid A, L])）可能无因果意义。")])])],-1)),t[6]||(t[6]=m('<p><strong>结论</strong>：G-公式通过模拟反事实世界（图21.1–21.2）解决传统方法的偏倚。</p><hr><h4 id="_21-2-时变处理的ip加权" tabindex="-1"><a class="header-anchor" href="#_21-2-时变处理的ip加权"><span><strong>21.2 时变处理的IP加权</strong></span></a></h4><p><strong>核心思想</strong>：创建伪总体（pseudo-population），其中治疗分配与混杂因素无关。<br><strong>技术要点</strong>：</p><ol><li><p><strong>权重定义</strong>：</p><ul><li><strong>非稳定权重</strong>：<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>W</mi><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover></msup><mo>=</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><mfrac><mn>1</mn><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mi>k</mi></msub><mo>∣</mo><msub><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>L</mi><mo>ˉ</mo></mover><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">W^{\\bar{A}} = \\prod_{k=0}^K \\frac{1}{f(A_k \\mid \\bar{A}_{k-1}, \\bar{L}_k)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9871em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9871em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight">A</span></span><span style="top:-2.9523em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.2899em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">L</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9601em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></li><li><strong>稳定权重</strong>：<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><msup><mi>W</mi><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover></msup><mo>=</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><mfrac><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mi>k</mi></msub><mo>∣</mo><msub><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mi>k</mi></msub><mo>∣</mo><msub><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>L</mi><mo>ˉ</mo></mover><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">SW^{\\bar{A}} = \\prod_{k=0}^K \\frac{f(A_k \\mid \\bar{A}_{k-1})}{f(A_k \\mid \\bar{A}_{k-1}, \\bar{L}_k)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9871em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9871em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight">A</span></span><span style="top:-2.9523em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4971em;"><span style="top:-2.2899em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">L</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9601em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></li></ul></li><li><p><strong>估计反事实均值</strong>：</p><ul><li>在伪总体中，(E[Y^{\\bar{a}}] = E_{\\text{ps}}[Y \\mid \\bar{A} = \\bar{a}])（即按权重加权后 (\\bar{A} = \\bar{a}) 组的 (Y) 均值）。</li></ul></li><li><p><strong>应用示例</strong>（表21.1）：</p><ul><li>非稳定权重下，(\\hat{E}[Y^{0,0}] = \\hat{E}[Y^{1,1}] = 60)，效应估计为0（图21.3）。</li></ul></li><li><p><strong>边际结构模型（MSM）</strong>：</p><ul><li>处理高维策略：拟合饱和或非饱和模型（如 (E[Y^{\\bar{a}}] = \\beta_0 + \\beta_1 \\text{cum}(\\bar{a}))）。</li><li>使用加权最小二乘法（WLS）估计参数，权重为 (SW^{\\bar{A}}) 或 (W^{\\bar{A}})。</li></ul></li></ol><p><strong>结论</strong>：IP加权与G-公式等价，但更易处理高维数据，且不受<strong>g-null悖论</strong>影响（技术点21.3）。</p><hr><h4 id="_21-3-双重稳健估计器" tabindex="-1"><a class="header-anchor" href="#_21-3-双重稳健估计器"><span><strong>21.3 双重稳健估计器</strong></span></a></h4><p><strong>核心思想</strong>：结合治疗模型和结局模型，任一正确即可获得无偏估计。<br><strong>技术要点</strong>：</p><ol><li><p><strong>三步法</strong>（以&quot;始终治疗&quot;策略 (\\bar{a}=1) 为例）：</p><ul><li><strong>步骤1</strong>：估计治疗概率 (\\pi_k = \\Pr(A_k=1 \\mid \\bar{A}_{k-1}=1, \\bar{L}_k))。</li><li><strong>步骤2</strong>：从时间 (K) 到 (0) 拟合序列回归模型，加入IP权重作为协变量。</li><li><strong>步骤3</strong>：计算所有个体的 (B_0) 样本均值作为 (\\hat{E}[Y^{\\bar{a}}])。</li></ul></li><li><p><strong>多重稳健性</strong>：</p><ul><li><strong>双重稳健</strong>：若所有治疗模型或所有结局模型正确，则估计无偏。</li><li><strong>K+2稳健</strong>：对任意 (m)，若时间 (0) 至 (m) 的治疗模型和时间 (m+1) 至 (K) 的结局模型正确，则无偏。</li></ul></li></ol><p><strong>结论</strong>：双重稳健方法（如TMLE）在高维数据中提供更强的鲁棒性（技术点21.4–21.6）。</p><hr><h4 id="_21-4-时变处理的g-估计" tabindex="-1"><a class="header-anchor" href="#_21-4-时变处理的g-估计"><span><strong>21.4 时变处理的G-估计</strong></span></a></h4><p><strong>核心思想</strong>：通过结构嵌套均值模型（SNMM）估计处理效应，消除时变混杂偏倚。<br><strong>技术要点</strong>：</p><ol><li><p><strong>模型结构</strong>：</p><ul><li>例如两时间点模型： <ul><li>时间 (k=0)： (E[Y^{a_0,0} - Y^{0,0} \\mid A_0=a_0] = \\beta_0 a_0)</li><li>时间 (k=1)： (E[Y^{a_0,a_1} - Y^{a_0,0} \\mid L_1}, A_0=a_0] = a_1(\\beta_{11} + \\beta_{12} L_1 + \\cdots))</li></ul></li></ul></li><li><p><strong>G-估计步骤</strong>：</p><ul><li>构造候选反事实 (H_k(\\psi^\\dagger))（如 (H_1(\\psi) = Y - A_1(\\psi_{11} + \\psi_{12} L_1 + \\cdots))）。</li><li>求解 (\\psi) 使得治疗概率模型中的 (H_k(\\psi)) 系数为0（技术点21.8）。</li></ul></li><li><p><strong>反事实均值估计</strong>：</p><ul><li>(E[Y^0]) 由 (H_0(\\hat{\\beta})) 的样本均值估计。</li><li>动态策略需蒙特卡洛模拟（技术点21.9）。</li></ul></li></ol><p><strong>结论</strong>：G-估计适用于复杂模型，且保留零效应下的无偏性。</p><hr><h4 id="_21-5-删失作为时变处理" tabindex="-1"><a class="header-anchor" href="#_21-5-删失作为时变处理"><span><strong>21.5 删失作为时变处理</strong></span></a></h4><p><strong>核心思想</strong>：将删失视为额外时变处理，扩展G-方法。<br><strong>技术要点</strong>：</p><ol><li><p><strong>IP加权调整</strong>：</p><ul><li>非稳定权重：<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>W</mi><mover accent="true"><mi>C</mi><mo>ˉ</mo></mover></msup><mo>=</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>K</mi><mo>+</mo><mn>1</mn></mrow></munderover><mfrac><mn>1</mn><mrow><mi>Pr</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>C</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn><mo>∣</mo><msub><mover accent="true"><mi>C</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>0</mn><mo separator="true">,</mo><msub><mover accent="true"><mi>A</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>L</mi><mo>ˉ</mo></mover><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">W^{\\bar{C}} = \\prod_{k=1}^{K+1} \\frac{1}{\\Pr(C_k=0 \\mid \\bar{C}_{k-1}=0, \\bar{A}_{k-1}, \\bar{L}_{k-1})} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9871em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9871em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span><span style="top:-2.9523em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.2899em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">Pr</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">L</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9601em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p></li><li>联合处理 ((\\bar{A}, \\bar{C})) 的权重为 (W^{\\bar{A}} \\times W^{\\bar{C}})。</li></ul></li><li><p><strong>G-公式调整</strong>：</p><ul><li>所有项条件于未删失状态（(\\bar{C} = \\bar{0})）。</li></ul></li></ol><p><strong>结论</strong>：调整后可估计 (E[Y^{\\bar{a}, \\bar{c}=\\bar{0}}])（即无删失时的因果效应）。</p><hr><h4 id="_21-6-广义g-公式" tabindex="-1"><a class="header-anchor" href="#_21-6-广义g-公式"><span><strong>21.6 广义G-公式</strong></span></a></h4><p><strong>核心思想</strong>：在包含未测变量的因果DAG下，G-公式可推广为<strong>广义G-公式</strong>（big g-formula）。<br><strong>技术要点</strong>：</p><ul><li>若所有变量（含未测 (U)）已知，则广义G-公式可识别 (E[Y^g])。</li><li><strong>前门准则</strong>等非混杂场景是广义G-公式的特例（技术点21.11–21.12）。</li></ul><p><strong>结论</strong>：不同识别条件（如序贯可交换性、前门准则）数学上统一于广义G-公式框架。</p><hr><h3 id="关键图表" tabindex="-1"><a class="header-anchor" href="#关键图表"><span><strong>关键图表</strong></span></a></h3><ul><li><strong>表21.1</strong>：时变处理实验数据（8组，样本量、(A_0, L_1, A_1, Y) 均值）。</li><li><strong>图21.1</strong>：观测数据的因果树图。</li><li><strong>图21.2</strong>：&quot;始终治疗&quot;策略的反事实树图。</li><li><strong>图21.3</strong>：IP加权伪总体树图（含权重 (W^{\\bar{A}}) 和伪总体大小）。</li><li><strong>图21.4</strong>：生存分析中时变处理的因果图（含删失）。</li></ul><blockquote><p><strong>注</strong>：所有方法均依赖可识别性条件（序贯可交换性、正值性、一致性）。实际应用中需警惕模型误设，建议结合多种方法（如G-公式与IP加权）验证结果。</p></blockquote>',30))])}const d=l(o,[["render",h]]),v=JSON.parse(`{"path":"/posts/Causal%20inference/What-if%20book%20reading%20notes/response_md/DeepSeek-R1-0528-1st/Chapter_21.html","title":"Chapter_21","lang":"en-US","frontmatter":{"title":"Chapter_21","category":"Causal inference","tags":["DeepSeek-R1-0528-1st","response_md"],"description":"### 第21章总结：时变处理的G-方法 本章解决传统方法在存在**治疗-混杂因素反馈**（treatment-confounder feedback）的时变处理中的偏倚问题，引入三类**G-方法**（g-formula、IP加权、g-估计及其双重稳健推广）作为解决方案。所有方法均基于可识别性条件（序贯可交换性、正值性、一致性），并在模拟数据集（表21...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Chapter_21\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-17T03:19:05.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Aaron L\\",\\"url\\":\\"https://aaronlzm.github.io\\",\\"email\\":\\"lzm_aaron@outlook.com\\"}]}"],["meta",{"property":"og:url","content":"https://aaronlzm.github.io/posts/Causal%20inference/What-if%20book%20reading%20notes/response_md/DeepSeek-R1-0528-1st/Chapter_21.html"}],["meta",{"property":"og:site_name","content":"Aaron's Blog"}],["meta",{"property":"og:title","content":"Chapter_21"}],["meta",{"property":"og:description","content":"### 第21章总结：时变处理的G-方法 本章解决传统方法在存在**治疗-混杂因素反馈**（treatment-confounder feedback）的时变处理中的偏倚问题，引入三类**G-方法**（g-formula、IP加权、g-估计及其双重稳健推广）作为解决方案。所有方法均基于可识别性条件（序贯可交换性、正值性、一致性），并在模拟数据集（表21..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-09-17T03:19:05.000Z"}],["meta",{"property":"article:tag","content":"response_md"}],["meta",{"property":"article:tag","content":"DeepSeek-R1-0528-1st"}],["meta",{"property":"article:modified_time","content":"2025-09-17T03:19:05.000Z"}]]},"git":{"createdTime":1758079145000,"updatedTime":1758079145000,"contributors":[{"name":"lizhimou","username":"lizhimou","email":"lizhimou@bytedance.com","commits":1,"url":"https://github.com/lizhimou"}]},"readingTime":{"minutes":5.85,"words":1754},"filePathRelative":"posts/Causal inference/What-if book reading notes/response_md/DeepSeek-R1-0528-1st/Chapter_21.md","excerpt":"\\n### 第21章总结：时变处理的G-方法  \\n本章解决传统方法在存在**治疗-混杂因素反馈**（treatment-confounder feedback）的时变处理中的偏倚问题，引入三类**G-方法**（g-formula、IP加权、g-估计及其双重稳健推广）作为解决方案。所有方法均基于可识别性条件（序贯可交换性、正值性、一致性），并在模拟数据集（表21.1）中成功估计零效应（真实效应为0），而传统方法失败。\\n","autoDesc":true}`);export{d as comp,v as data};
