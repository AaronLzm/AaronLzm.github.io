import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,f as a,d as n,a as l,r as e,b as o}from"./app-DTT-b9WU.js";const p={};function m(g,s){const t=e("Mermaid");return o(),i("div",null,[s[2]||(s[2]=a('<h3 id="标准化方法-standardization" tabindex="-1"><a class="header-anchor" href="#标准化方法-standardization"><span><strong>标准化方法（Standardization）</strong></span></a></h3><h4 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span><strong>原理</strong></span></a></h4><p>标准化是一种非参数方法，用于估计<strong>反事实期望</strong> $$E[Y^{a,c=0}]$$（在干预设定所有人接受处理 (a) 且未删失时的潜在结果均值）。其核心思想是通过对混杂变量 (L) 的分布进行调整，消除混杂偏倚：<br> [</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo stretchy="false">[</mo><msup><mi>Y</mi><mrow><mi>a</mi><mo separator="true">,</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow></msup><mo stretchy="false">]</mo><mo>=</mo><munder><mo>∑</mo><mi>l</mi></munder><mi>E</mi><mo stretchy="false">[</mo><mi>Y</mi><mo>∣</mo><mi>A</mi><mo>=</mo><mi>a</mi><mo separator="true">,</mo><mi>C</mi><mo>=</mo><mn>0</mn><mo separator="true">,</mo><mi>L</mi><mo>=</mo><mi>l</mi><mo stretchy="false">]</mo><mo>⋅</mo><mi>Pr</mi><mo>⁡</mo><mo stretchy="false">[</mo><mi>L</mi><mo>=</mo><mi>l</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">E[Y^{a,c=0}] = \\sum_{l} E[Y \\mid A=a, C=0, L=l] \\cdot \\Pr[L=l] </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3521em;vertical-align:-1.3021em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">Pr</span><span class="mopen">[</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">]</span></span></span></span></span></p><p>]</p><ul><li><strong>可交换性</strong>：当 (L) 充分调整混杂时，组间可比（(Y^a \\perp!!!\\perp A \\mid L)）。</li><li><strong>正性</strong>：所有 (L) 层中处理概率非零（(\\Pr[A=a \\mid L=l] &gt; 0)）。</li><li><strong>一致性</strong>：观测结果等于潜在结果（若 (A_i=a)，则 (Y_i = Y_i^a)）。</li></ul><h4 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法"><span><strong>使用方法</strong></span></a></h4><ol><li><strong>分层估计</strong>： <ul><li>将数据按混杂变量 (L) 的值分层（如性别、年龄组）。</li><li>计算每层内处理组 (A=a) 的均值 (E[Y \\mid A=a, C=0, L=l])。</li></ul></li><li><strong>加权平均</strong>： <ul><li>用总体中 (L=l) 的比例 (\\Pr[L=l]) 作为权重，对层均值加权求和。</li><li><strong>公式</strong>：<br> [<br> \\hat{E}[Y^{a,c=0}] = \\sum_{l} \\hat{E}[Y \\mid A=a, C=0, L=l] \\cdot \\frac{n_l}{n}<br> ]<br> (n_l) 为 (L=l) 的样本量，(n) 为总样本量。</li></ul></li></ol><h4 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span><strong>注意事项</strong></span></a></h4><ul><li><strong>低维数据适用</strong>：当 (L) 维度低且离散时可行（如仅3-5个类别）。</li><li><strong>高维问题</strong>：若 (L) 包含连续变量或多类别（如年龄、体重），分层后某些层样本极少，估计不稳定（<strong>维度灾难</strong>）。</li><li><strong>正性违反</strong>：若某层 (\\Pr[A=a \\mid L=l]=0)（如男性高龄者无戒烟者），则该层无法估计，需依赖模型外推（引入偏倚风险）。</li></ul><hr><h3 id="参数化g公式-parametric-g-formula" tabindex="-1"><a class="header-anchor" href="#参数化g公式-parametric-g-formula"><span><strong>参数化g公式（Parametric g-formula）</strong></span></a></h3><h4 id="原理-1" tabindex="-1"><a class="header-anchor" href="#原理-1"><span><strong>原理</strong></span></a></h4><p>g公式是标准化的<strong>参数化推广</strong>，用于解决高维混杂问题：<br> [<br> E[Y^{a,c=0}] = \\int E[Y \\mid A=a, C=0, L=l] dF_L(l)<br> ]</p><ul><li>通过参数模型估计 (E[Y \\mid A, L])，避免直接分层。</li><li>用经验分布 (\\hat{F}_L(l))（样本分布）替代理论分布 (F_L(l))，实现“自动加权”。</li></ul><h4 id="使用方法-四步法" tabindex="-1"><a class="header-anchor" href="#使用方法-四步法"><span><strong>使用方法（四步法）</strong></span></a></h4>',16)),n("ol",null,[n("li",null,[s[0]||(s[0]=a("<p><strong>数据扩展</strong>：</p><ul><li>复制原始数据集为三份： <ul><li><strong>Block 1</strong>：原始观测数据（保留 (A, Y, L)）。</li><li><strong>Block 2</strong>：强制所有个体 (A=0)，(Y) 设为缺失。</li><li><strong>Block 3</strong>：强制所有个体 (A=1)，(Y) 设为缺失。</li></ul></li></ul>",2)),l(t,{code:"eJxLL0osyFDwCeJyiX7aN//p8u5nUzc8610Xq6Cra6fgZBjtlJOfnK1gaKXgqBOp46PwZP/c51NnxnK5QOSNoPJGQHlbAx2FyOd7dj1dshEubwyVNwbJGyLJAwCyNyxL"})]),s[1]||(s[1]=a("<li><p><strong>结果建模</strong>：</p><ul><li>用 <strong>Block 1</strong> 拟合回归模型：<br> [<br> Y = \\beta_0 + \\beta_1 A + \\beta_2^T L + \\beta_3^T (A \\times L) + \\epsilon<br> ] <ul><li>例如：包含年龄、体重的二次项及交互项。</li></ul></li></ul></li><li><p><strong>预测潜在结果</strong>：</p><ul><li>用模型预测 <strong>Block 2</strong> 和 <strong>Block 3</strong> 的 (Y)： <ul><li>Block 2：(\\hat{Y}_i^{a=0} = \\hat{E}[Y \\mid A=0, L=l_i])</li><li>Block 3：(\\hat{Y}_i^{a=1} = \\hat{E}[Y \\mid A=1, L=l_i])</li></ul></li></ul></li><li><p><strong>标准化平均</strong>：</p><ul><li>计算反事实均值：<br> [<br> \\hat{E}[Y^{a}] = \\frac{1}{n} \\sum_{i=1}^n \\hat{Y}_i^{a}<br> ]</li><li>因果效应：(\\hat{\\tau} = \\hat{E}[Y^{a=1}] - \\hat{E}[Y^{a=0}])</li></ul></li>",3))]),s[3]||(s[3]=a('<h4 id="注意事项-1" tabindex="-1"><a class="header-anchor" href="#注意事项-1"><span><strong>注意事项</strong></span></a></h4><ol><li><p><strong>模型依赖性</strong>：</p><ul><li>结果模型 (E[Y \\mid A,L]) 必须正确指定（如非线性关系需多项式项）。</li><li><strong>误设后果</strong>：若模型遗漏重要交互项（如 (A \\times \\text{年龄})），效应估计偏倚。</li></ul></li><li><p><strong>正性问题处理</strong>：</p><ul><li>当某 (L=l) 下无个体接受处理（(\\Pr[A=a \\mid L=l]=0)），模型通过<strong>外推</strong>预测 (Y)。</li><li><strong>风险</strong>：外推部分无数据支持，依赖模型假设（需敏感性分析）。</li></ul></li><li><p><strong>双稳健性缺失</strong>：</p><ul><li>传统g公式仅依赖结果模型。</li><li><strong>改进</strong>：用双稳健估计（见Fine Point 13.2），结合处理模型 (\\Pr[A=a \\mid L]) 增强可靠性。</li></ul></li><li><p><strong>置信区间计算</strong>：</p><ul><li>使用<strong>Bootstrap法</strong>（Technical Point 13.1）： <ul><li>重抽样 (B) 次（如 (B=1000)），每次重复g公式步骤。</li><li>取2.5%和97.5%分位数作为95% CI。</li></ul></li></ul></li></ol><hr><h3 id="关键对比-标准化-vs-参数化g公式" tabindex="-1"><a class="header-anchor" href="#关键对比-标准化-vs-参数化g公式"><span><strong>关键对比：标准化 vs. 参数化g公式</strong></span></a></h3><table><thead><tr><th><strong>特性</strong></th><th><strong>标准化</strong></th><th><strong>参数化g公式</strong></th></tr></thead><tbody><tr><td><strong>适用维度</strong></td><td>低维 (L)（离散、少类别）</td><td>高维 (L)（连续、多类别）</td></tr><tr><td><strong>模型依赖</strong></td><td>非参数（无模型）</td><td>需指定结果模型 (E[Y|A,L])</td></tr><tr><td><strong>正性违反</strong></td><td>无法计算（层内无数据）</td><td>模型外推（可能偏倚）</td></tr><tr><td><strong>计算复杂度</strong></td><td>简单（直接加权）</td><td>较高（需数据扩展、预测）</td></tr><tr><td><strong>稳定性</strong></td><td>高（方差小）</td><td>依赖模型质量</td></tr></tbody></table><hr><h3 id="实践建议" tabindex="-1"><a class="header-anchor" href="#实践建议"><span><strong>实践建议</strong></span></a></h3><ol><li><p><strong>首选双稳健方法</strong>（如Bang-Robins估计器）：</p><ul><li>同时拟合处理模型 (\\pi(L)) 和结果模型 (b(L))。</li><li>只要一个模型正确，效应估计即一致。</li></ul></li><li><p><strong>敏感性分析</strong>：</p><ul><li><strong>模型误设</strong>：尝试不同模型规格（如添加/删除交互项）。</li><li><strong>未测量混杂</strong>：使用E值量化混杂强度（Fine Point 7.1）。</li><li><strong>正性</strong>：检查 $$\\hat{\\pi}(L)$$ 的分布，避免接近0的值。</li></ul></li><li><p><strong>报告结果</strong>：</p><ul><li>同时给出IP加权和g公式估计，若差异 &gt;10%，提示模型问题。</li><li>示例：戒烟效应估计为3.5kg，但需声明依赖可交换性等强假设。</li></ul></li></ol>',8)),l(t,{code:"eJw9z81OwkAUBeD9PMW8AK9gIpY/49LdZBaucGncWhNjkJaMdZpoCYkyBRdEElMx6IJS36bnYle+gu1A2N7v3nNyu5dnF+f81GGHorgZkJrTcEXLSPJa7YDXrxBo6FHh6ZPN+gvpLP95+Mvia1av3KXRh8uPRDE20LcULWjiwevjfih3CwhnLnfEVst5F3fvyLRkjs1viOooSGgwx2ckWcNOm4JUjNDfrB/JvNDbFEZJ1rTWEsVrj74VdJCnComRrGWhLfblWC0x9iRrW+gIPE+qnMhH+pRni99kKlnH2nHZr6kXl4/B75MJJfsHWHyNxg=="})])}const d=r(p,[["render",m]]),u=JSON.parse(`{"path":"/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2013/%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E6%A0%87%E5%87%86%E5%8C%96%E6%96%B9%E6%B3%95%20%E5%92%8C%E5%8F%82%E6%95%B0%E5%8C%96g%E5%85%AC%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.html","title":"详细解释一下标准化方法 和参数化g公式的原理和使用方法及注意事项","lang":"en-US","frontmatter":{"title":"详细解释一下标准化方法 和参数化g公式的原理和使用方法及注意事项","category":"Causal inference","tags":["Chapter 13","What-if book reading notes"],"description":"标准化方法（Standardization） 原理 标准化是一种非参数方法，用于估计反事实期望 $$E[Y^{a,c=0}]$$（在干预设定所有人接受处理 (a) 且未删失时的潜在结果均值）。其核心思想是通过对混杂变量 (L) 的分布进行调整，消除混杂偏倚： [ E[Ya,c=0]=l∑​E[Y∣A=a,C=0,L=l]⋅Pr[L=l] ] 可交换性：...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"详细解释一下标准化方法 和参数化g公式的原理和使用方法及注意事项\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-17T03:19:05.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Aaron L\\",\\"url\\":\\"https://aaronlzm.github.io\\",\\"email\\":\\"lzm_aaron@outlook.com\\"}]}"],["meta",{"property":"og:url","content":"https://aaronlzm.github.io/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2013/%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E6%A0%87%E5%87%86%E5%8C%96%E6%96%B9%E6%B3%95%20%E5%92%8C%E5%8F%82%E6%95%B0%E5%8C%96g%E5%85%AC%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.html"}],["meta",{"property":"og:site_name","content":"Aaron's Blog"}],["meta",{"property":"og:title","content":"详细解释一下标准化方法 和参数化g公式的原理和使用方法及注意事项"}],["meta",{"property":"og:description","content":"标准化方法（Standardization） 原理 标准化是一种非参数方法，用于估计反事实期望 $$E[Y^{a,c=0}]$$（在干预设定所有人接受处理 (a) 且未删失时的潜在结果均值）。其核心思想是通过对混杂变量 (L) 的分布进行调整，消除混杂偏倚： [ E[Ya,c=0]=l∑​E[Y∣A=a,C=0,L=l]⋅Pr[L=l] ] 可交换性：..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-09-17T03:19:05.000Z"}],["meta",{"property":"article:tag","content":"What-if book reading notes"}],["meta",{"property":"article:tag","content":"Chapter 13"}],["meta",{"property":"article:modified_time","content":"2025-09-17T03:19:05.000Z"}]]},"git":{"createdTime":1758079145000,"updatedTime":1758079145000,"contributors":[{"name":"lizhimou","username":"lizhimou","email":"lizhimou@bytedance.com","commits":1,"url":"https://github.com/lizhimou"}]},"readingTime":{"minutes":4.48,"words":1343},"filePathRelative":"posts/Causal inference/What-if book reading notes/Chapter 13/详细解释一下标准化方法 和参数化g公式的原理和使用方法及注意事项.md","excerpt":"<h3><strong>标准化方法（Standardization）</strong></h3>\\n<h4><strong>原理</strong></h4>\\n<p>标准化是一种非参数方法，用于估计<strong>反事实期望</strong> $$E[Y^{a,c=0}]$$（在干预设定所有人接受处理 (a) 且未删失时的潜在结果均值）。其核心思想是通过对混杂变量 (L) 的分布进行调整，消除混杂偏倚：<br>\\n[</p>","autoDesc":true}`);export{d as comp,u as data};
