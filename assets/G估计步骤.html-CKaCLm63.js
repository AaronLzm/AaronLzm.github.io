import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,d as s,f as l,g as a,b as e}from"./app-0zlnUqcy.js";const o={};function c(r,n){return e(),t("div",null,[...n[0]||(n[0]=[s("p",null,[a("要正确执行 g-估计（g-estimation）来估计结构嵌套模型（SNM）参数 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",{mathvariant:"bold-italic"},"β"),s("mo",null,"="),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"β"),s("mn",null,"1")]),s("mo",{separator:"true"},","),s("msup",null,[s("mi",null,[s("msub",null,[s("mi",{mathvariant:"bold-italic"},"β"),s("mn",{mathvariant:"bold"},"2")])]),s("mi",{mathvariant:"normal"},"⊤")]),s("msup",null,[s("mo",{stretchy:"false"},")"),s("mi",{mathvariant:"normal"},"⊤")])]),s("annotation",{encoding:"application/x-tex"},"\\boldsymbol{\\beta} = (\\beta_1, \\boldsymbol{\\beta_2}^\\top)^\\top")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β")])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1834em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.05278em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0528em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.034em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathbf mtight"},"2")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.9334em"}},[s("span",{style:{top:"-3.1473em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"⊤")])])])])])])]),s("span",{class:"mclose"},[s("span",{class:"mclose"},")"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8491em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"⊤")])])])])])])])])])]),a("，需遵循以下步骤。以下是结合数学原理和 Python 实现的完整指南：")],-1),s("hr",null,null,-1),s("h3",{id:"g-估计的数学原理",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#g-估计的数学原理"},[s("span",null,[s("strong",null,"g-估计的数学原理")])])],-1),s("p",null,"给定模型：",-1),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mi",null,"E"),s("mo",{stretchy:"false"},"["),s("msup",null,[s("mi",null,"Y"),s("mi",null,"a")]),s("mo",null,"−"),s("msup",null,[s("mi",null,"Y"),s("mrow",null,[s("mi",null,"a"),s("mo",null,"="),s("mn",null,"0")])]),s("mo",null,"∣"),s("mi",null,"A"),s("mo",null,"="),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"L"),s("mo",{stretchy:"false"},"]"),s("mo",null,"="),s("msub",null,[s("mi",null,"β"),s("mn",null,"1")]),s("mi",null,"a"),s("mo",null,"+"),s("msup",null,[s("mi",null,[s("msub",null,[s("mi",{mathvariant:"bold-italic"},"β"),s("mn",{mathvariant:"bold"},"2")])]),s("mi",{mathvariant:"normal"},"⊤")]),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mi",null,"L"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"E[Y^a - Y^{a=0} \\mid A=a, L] = \\beta_1 a + \\boldsymbol{\\beta_2}^\\top (a L) ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E"),s("span",{class:"mopen"},"["),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7144em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"a")])])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1141em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8641em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"a"),s("span",{class:"mrel mtight"},"="),s("span",{class:"mord mtight"},"0")])])])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"∣"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6833em"}}),s("span",{class:"mord mathnormal"},"A"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.05278em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0528em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1834em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.034em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathbf mtight"},"2")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.9334em"}},[s("span",{style:{top:"-3.1473em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"⊤")])])])])])])]),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mclose"},")")])])])])],-1),s("p",null,[a("定义 "),s("strong",null,"去混杂的潜在结果"),a("：")],-1),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mi",null,"H"),s("mo",{stretchy:"false"},"("),s("mi",{mathvariant:"bold-italic"},"β"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mi",null,"Y"),s("mo",null,"−"),s("msub",null,[s("mi",null,"β"),s("mn",null,"1")]),s("mi",null,"A"),s("mo",null,"−"),s("msup",null,[s("mi",null,[s("msub",null,[s("mi",{mathvariant:"bold-italic"},"β"),s("mn",{mathvariant:"bold"},"2")])]),s("mi",{mathvariant:"normal"},"⊤")]),s("mo",{stretchy:"false"},"("),s("mi",null,"A"),s("mo",null,"⊙"),s("mi",null,"L"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"H(\\boldsymbol{\\beta}) = Y - \\beta_1 A - \\boldsymbol{\\beta_2}^\\top (A \\odot L) ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.08125em"}},"H"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β")])]),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7667em","vertical-align":"-0.0833em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.22222em"}},"Y"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.05278em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0528em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mord mathnormal"},"A"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1834em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.034em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathbf mtight"},"2")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.9334em"}},[s("span",{style:{top:"-3.1473em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"⊤")])])])])])])]),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"A"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"⊙"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mclose"},")")])])])])],-1),l('<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊙</mo></mrow><annotation encoding="application/x-tex">\\odot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">⊙</span></span></span></span> 表示逐元素乘法（若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 是向量）。</p><p><strong>核心假设</strong>：在真实 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold-italic">β</mi></mrow><annotation encoding="application/x-tex">\\boldsymbol{\\beta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span></span></span></span> 下，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(\\boldsymbol{\\beta})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 在给定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 的条件下独立：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>⊥</mo><mi>H</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo>∣</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">A \\perp H(\\boldsymbol{\\beta}) \\mid L </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span></span></p><p><strong>估计策略</strong>：</p>',4),s("ol",null,[s("li",null,[a("拟合倾向得分模型："),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"P"),s("mo",{stretchy:"false"},"("),s("mi",null,"A"),s("mo",null,"="),s("mn",null,"1"),s("mo",null,"∣"),s("mi",null,"L"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mtext",null,"expit"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"α"),s("mn",null,"0")]),s("mo",null,"+"),s("msup",null,[s("mi",null,[s("msub",null,[s("mi",{mathvariant:"bold-italic"},"α"),s("mn",{mathvariant:"bold"},"1")])]),s("mi",{mathvariant:"normal"},"⊤")]),s("mi",null,"L"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"P(A=1 \\mid L) = \\text{expit}(\\alpha_0 + \\boldsymbol{\\alpha_1}^\\top L)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"P"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"A"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},"1"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"∣"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord text"},[s("span",{class:"mord"},"expit")]),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.0037em"}},"α"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.0037em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"0")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0991em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol"},"α"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathbf mtight"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])]),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8491em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"⊤")])])])])])])]),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mclose"},")")])])])]),s("li",null,[a("对候选 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",{mathvariant:"bold-italic"},"β")]),s("annotation",{encoding:"application/x-tex"},"\\boldsymbol{\\beta}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β")])])])])]),a("，检验 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"H"),s("mo",{stretchy:"false"},"("),s("mi",{mathvariant:"bold-italic"},"β"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"H(\\boldsymbol{\\beta})")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.08125em"}},"H"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β")])]),s("span",{class:"mclose"},")")])])]),a(" 与 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"A")]),s("annotation",{encoding:"application/x-tex"},"A")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6833em"}}),s("span",{class:"mord mathnormal"},"A")])])]),a(" 的条件独立性（通过倾向得分模型中 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"H"),s("mo",{stretchy:"false"},"("),s("mi",{mathvariant:"bold-italic"},"β"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"H(\\boldsymbol{\\beta})")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.08125em"}},"H"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord"},[s("span",{class:"mord boldsymbol",style:{"margin-right":"0.03403em"}},"β")])]),s("span",{class:"mclose"},")")])])]),a(" 的系数是否为 0）")])],-1),l(`<hr><h3 id="g-估计的步骤与-python-实现" tabindex="-1"><a class="header-anchor" href="#g-估计的步骤与-python-实现"><span><strong>g-估计的步骤与 Python 实现</strong></span></a></h3><h4 id="步骤-1-准备数据" tabindex="-1"><a class="header-anchor" href="#步骤-1-准备数据"><span><strong>步骤 1：准备数据</strong></span></a></h4><p>假设数据集包含：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>: 结局变量 (连续)</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>: 处理变量 (二元)</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>: 协变量向量 (如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>L</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">L_1, L_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</li></ul><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> numpy </span><span style="color:#81A1C1;">as</span><span style="color:#D8DEE9FF;"> np</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> pandas </span><span style="color:#81A1C1;">as</span><span style="color:#D8DEE9FF;"> pd</span></span>
<span class="line"><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> sklearn</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">linear_model </span><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> LogisticRegression</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 生成模拟数据 (n=样本量, p=协变量维数)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">np</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">random</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">seed</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">42</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">n </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 1000</span></span>
<span class="line"><span style="color:#D8DEE9FF;">p </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 2</span><span style="color:#616E88;">  # 假设 L = [L1, L2]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 生成协变量 L</span></span>
<span class="line"><span style="color:#D8DEE9FF;">L </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">random</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">normal</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">n</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> p</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 生成处理 A (依赖 L)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">true_alpha </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">array</span><span style="color:#ECEFF4;">([</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">0.5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0.8</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1.2</span><span style="color:#ECEFF4;">])</span><span style="color:#616E88;">  # [alpha0, alpha1, alpha2]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">propensity_score </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 1</span><span style="color:#81A1C1;"> /</span><span style="color:#ECEFF4;"> (</span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exp</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">-</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">true_alpha</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> L </span><span style="color:#81A1C1;">@</span><span style="color:#D8DEE9FF;"> true_alpha</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">:])))</span></span>
<span class="line"><span style="color:#D8DEE9FF;">A </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">random</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">binomial</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> propensity_score</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 生成结局 Y (依赖 A 和 L)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">true_beta </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">array</span><span style="color:#ECEFF4;">([</span><span style="color:#B48EAD;">1.5</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">0.7</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0.3</span><span style="color:#ECEFF4;">])</span><span style="color:#616E88;">  # [beta1, beta2_L1, beta2_L2]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">Y0 </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 3.0</span><span style="color:#81A1C1;"> +</span><span style="color:#B48EAD;"> 0.5</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;"> L</span><span style="color:#ECEFF4;">[:,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;"> 0.2</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;"> L</span><span style="color:#ECEFF4;">[:,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">random</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">normal</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">n</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">Y </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> Y0 </span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9FF;"> A </span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">true_beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> true_beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">L</span><span style="color:#ECEFF4;">[:,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> true_beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">L</span><span style="color:#ECEFF4;">[:,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 创建 DataFrame</span></span>
<span class="line"><span style="color:#D8DEE9FF;">df </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> pd</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DataFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">column_stack</span><span style="color:#ECEFF4;">([</span><span style="color:#D8DEE9FF;">Y</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> A</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> L</span><span style="color:#ECEFF4;">]),</span><span style="color:#D8DEE9;"> columns</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Y</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-定义辅助函数" tabindex="-1"><a class="header-anchor" href="#步骤-2-定义辅助函数"><span><strong>步骤 2：定义辅助函数</strong></span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#81A1C1;">def</span><span style="color:#88C0D0;"> calc_H</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">beta</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> df</span><span style="color:#ECEFF4;">):</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;&quot;&quot;</span><span style="color:#A3BE8C;">计算去混杂的潜在结果 H(beta)</span><span style="color:#ECEFF4;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#616E88;">    # H = Y - β1*A - β2*(A⊙L)</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">Y</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9FF;"> beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9FF;"> beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9FF;"> beta</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">def</span><span style="color:#88C0D0;"> g_estimation_objective</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">beta</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> df</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> propensity_model</span><span style="color:#ECEFF4;">):</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;&quot;&quot;</span><span style="color:#A3BE8C;">计算目标函数：H(beta)在倾向得分模型中的系数</span><span style="color:#ECEFF4;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#616E88;">    # 计算 H(beta)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    H_beta </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> calc_H</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">beta</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span></span>
<span class="line"><span style="color:#616E88;">    # 在倾向得分模型中添加 H(beta) 作为协变量</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    X </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]].</span><span style="color:#88C0D0;">copy</span><span style="color:#ECEFF4;">()</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    X</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">H_beta</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> H_beta</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span></span>
<span class="line"><span style="color:#616E88;">    # 拟合扩展的倾向得分模型</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    extended_model </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> LogisticRegression</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">penalty</span><span style="color:#81A1C1;">=None</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> max_iter</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">1000</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    extended_model</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">X</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span></span>
<span class="line"><span style="color:#616E88;">    # 返回 H_beta 的系数 (目标：使其接近 0)</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9FF;"> extended_model</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">coef_</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">][</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">]</span><span style="color:#616E88;">  # 最后一个系数对应 H_beta</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-3-拟合基础倾向得分模型" tabindex="-1"><a class="header-anchor" href="#步骤-3-拟合基础倾向得分模型"><span><strong>步骤 3：拟合基础倾向得分模型</strong></span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#616E88;"># 拟合基础倾向得分模型 (A ~ L)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">base_model </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> LogisticRegression</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">penalty</span><span style="color:#81A1C1;">=None</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> max_iter</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">1000</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">base_model</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]],</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-4-优化目标函数" tabindex="-1"><a class="header-anchor" href="#步骤-4-优化目标函数"><span><strong>步骤 4：优化目标函数</strong></span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> scipy</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">optimize </span><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> minimize</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 定义优化目标 (最小化 |H_beta 的系数|)</span></span>
<span class="line"><span style="color:#81A1C1;">def</span><span style="color:#88C0D0;"> objective</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">beta</span><span style="color:#ECEFF4;">):</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    coef_H </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> g_estimation_objective</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">beta</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> base_model</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9FF;"> coef_H</span><span style="color:#81A1C1;">**</span><span style="color:#B48EAD;">2</span><span style="color:#616E88;">  # 最小化平方</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 初始参数猜测</span></span>
<span class="line"><span style="color:#D8DEE9FF;">beta_init </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">array</span><span style="color:#ECEFF4;">([</span><span style="color:#B48EAD;">0.0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0.0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0.0</span><span style="color:#ECEFF4;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 执行优化</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> minimize</span><span style="color:#ECEFF4;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    fun</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">objective</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    x0</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">beta_init</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    method</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">BFGS</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;">  # 拟牛顿法</span></span>
<span class="line"><span style="color:#D8DEE9;">    options</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">maxiter</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1000</span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 提取估计值</span></span>
<span class="line"><span style="color:#D8DEE9FF;">beta_hat </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> result</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">x</span></span>
<span class="line"><span style="color:#88C0D0;">print</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">f</span><span style="color:#A3BE8C;">&quot;Estimated parameters: β1=</span><span style="color:#EBCB8B;">{</span><span style="color:#D8DEE9FF;">beta_hat</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">:.3f</span><span style="color:#EBCB8B;">}</span><span style="color:#A3BE8C;">, β2_L1=</span><span style="color:#EBCB8B;">{</span><span style="color:#D8DEE9FF;">beta_hat</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">:.3f</span><span style="color:#EBCB8B;">}</span><span style="color:#A3BE8C;">, β2_L2=</span><span style="color:#EBCB8B;">{</span><span style="color:#D8DEE9FF;">beta_hat</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">:.3f</span><span style="color:#EBCB8B;">}</span><span style="color:#A3BE8C;">&quot;</span><span style="color:#ECEFF4;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-5-诊断与验证" tabindex="-1"><a class="header-anchor" href="#步骤-5-诊断与验证"><span><strong>步骤 5：诊断与验证</strong></span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#616E88;"># 计算最终 H(β_hat)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">H_final </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> calc_H</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">beta_hat</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 检查条件独立性：拟合 A ~ L + H(β_hat)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">final_model </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> LogisticRegression</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">penalty</span><span style="color:#81A1C1;">=None</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> max_iter</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">1000</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">X_final </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]].</span><span style="color:#88C0D0;">copy</span><span style="color:#ECEFF4;">()</span></span>
<span class="line"><span style="color:#D8DEE9FF;">X_final</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">H_final</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> H_final</span></span>
<span class="line"><span style="color:#D8DEE9FF;">final_model</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">X_final</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 输出 H(β_hat) 的系数和 p 值（近似）</span></span>
<span class="line"><span style="color:#D8DEE9FF;">coef_H_final </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> final_model</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">coef_</span><span style="color:#ECEFF4;">[</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">][</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#88C0D0;">print</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">f</span><span style="color:#A3BE8C;">&quot;Coefficient of H(β_hat) in propensity model: </span><span style="color:#EBCB8B;">{</span><span style="color:#D8DEE9FF;">coef_H_final</span><span style="color:#81A1C1;">:.4f</span><span style="color:#EBCB8B;">}</span><span style="color:#A3BE8C;">&quot;</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abs</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">coef_H_final</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#B48EAD;"> 0.1</span><span style="color:#ECEFF4;">:</span><span style="color:#616E88;">  # 实际中需计算标准误</span></span>
<span class="line"><span style="color:#88C0D0;">    print</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">✓ 条件独立假设可能成立 (系数接近 0)</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">else</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#88C0D0;">    print</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">⚠️ 可能违反条件独立假设 (遗漏混杂因子)</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="关键数学解释" tabindex="-1"><a class="header-anchor" href="#关键数学解释"><span><strong>关键数学解释</strong></span></a></h3><ol><li><p><strong>目标函数选择</strong>：</p><ul><li>最小化倾向得分模型中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(\\boldsymbol{\\beta})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span></span></span></span> 的系数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span>：</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mi mathvariant="bold-italic">β</mi></munder><msup><mrow><mo fence="true">[</mo><mi>γ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mn>2</mn></msup><mspace width="1em"></mspace><mtext>其中</mtext><mspace width="1em"></mspace><mi>γ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mtext>Coeff</mtext><mi>H</mi></msub><mtext> in logit</mtext><mo stretchy="false">(</mo><mi>A</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>L</mi><mo separator="true">,</mo><mi>H</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\\min_{\\boldsymbol{\\beta}} \\left[ \\gamma(\\boldsymbol{\\beta}) \\right]^2 \\quad \\text{其中} \\quad \\gamma(\\boldsymbol{\\beta}) = \\text{Coeff}_{H} \\text{ in } \\text{logit}(A=1|L, H(\\boldsymbol{\\beta})) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8422em;vertical-align:-0.8882em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.3479em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03403em;">β</span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord cjk_fallback">其中</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">Coeff</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord"> in </span></span><span class="mord text"><span class="mord">logit</span></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1∣</span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">))</span></span></span></span></span></p></li><li><p><strong>识别条件</strong>：</p><ul><li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\\gamma(\\boldsymbol{\\beta}) = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo><mo>⊥</mo><mi>A</mi><mo>∣</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">H(\\boldsymbol{\\beta}) \\perp A \\mid L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>，此时 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold-italic">β</mi></mrow><annotation encoding="application/x-tex">\\boldsymbol{\\beta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span></span></span></span> 是真实参数的无偏估计。</li></ul></li><li><p><strong>置信区间</strong>（补充）：</p><ul><li>用 Bootstrap 估计标准误：</li></ul><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> sklearn</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">utils </span><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> resample</span></span>
<span class="line"><span style="color:#D8DEE9FF;">beta_boots </span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;"> []</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> _ </span><span style="color:#81A1C1;">in</span><span style="color:#88C0D0;"> range</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">500</span><span style="color:#ECEFF4;">):</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    df_boot </span><span style="color:#81A1C1;">=</span><span style="color:#88C0D0;"> resample</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#616E88;">    # 重复步骤 2-4 计算 beta_hat_boot</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    beta_boots</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">beta_hat_boot</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">se </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">std</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">beta_boots</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> axis</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">ci </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> np</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">column_stack</span><span style="color:#ECEFF4;">([</span><span style="color:#D8DEE9FF;">beta_hat </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;"> 1.96</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">se</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> beta_hat </span><span style="color:#81A1C1;">+</span><span style="color:#B48EAD;"> 1.96</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">se</span><span style="color:#ECEFF4;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="确认-充分性的诊断" tabindex="-1"><a class="header-anchor" href="#确认-充分性的诊断"><span><strong>确认 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 充分性的诊断</strong></span></a></h3><ol><li><p><strong>倾向得分模型诊断</strong>：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code class="language-python"><span class="line"><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> sklearn</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">metrics </span><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> roc_auc_score</span></span>
<span class="line"><span style="color:#D8DEE9FF;">pred_probs </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> base_model</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">predict_proba</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">L1</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">L2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">]])[:,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#88C0D0;">print</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">f</span><span style="color:#A3BE8C;">&quot;Propensity score AUC: </span><span style="color:#EBCB8B;">{</span><span style="color:#88C0D0;">roc_auc_score</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">df</span><span style="color:#ECEFF4;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">],</span><span style="color:#D8DEE9FF;"> pred_probs</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">:.3f</span><span style="color:#EBCB8B;">}</span><span style="color:#A3BE8C;">&quot;</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#616E88;"># AUC &gt; 0.7 表明 L 对 A 有预测力</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>敏感性分析</strong>（未测量混杂）：</p><ul><li>假设存在未观测混杂 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span>，计算 E-value：</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>E-value</mtext><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>−</mo><mi>δ</mi></mrow></mfrac><mspace width="1em"></mspace><mtext>其中</mtext><mspace width="1em"></mspace><mi>δ</mi><mo>=</mo><mfrac><mover accent="true"><mi>β</mi><mo>^</mo></mover><msub><mover accent="true"><mi>β</mi><mo>^</mo></mover><mtext>adjusted</mtext></msub></mfrac></mrow><annotation encoding="application/x-tex"> \\text{E-value} = \\frac{1}{1 - \\delta} \\quad \\text{其中} \\quad \\delta = \\frac{ \\hat{\\beta} }{ \\hat{\\beta}_{\\text{adjusted}} } </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">E-value</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0908em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">其中</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7689em;vertical-align:-1.134em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6349em;"><span style="top:-2.1521em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">adjusted</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.134em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\\delta &lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 表示估计对混杂敏感</li></ul></li></ol><hr><h3 id="输出解释" tabindex="-1"><a class="header-anchor" href="#输出解释"><span><strong>输出解释</strong></span></a></h3><ul><li>若 <code>H(β_hat)</code> 的系数接近 0（如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>γ</mi><mi mathvariant="normal">∣</mi><mo>&lt;</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">| \\gamma | &lt; 0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.1</span></span></span></span>），则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 可能充分</li><li>若系数显著不为 0，则需： <ol><li>检查倾向得分模型拟合（如 AUC 低则遗漏预测因子）</li><li>添加候选混杂因子到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 并重新估计</li><li>进行敏感性分析量化潜在偏倚</li></ol></li></ul><p>此流程严格遵循 g-估计的理论框架，并通过数值优化实现参数估计。代码可直接用于实际数据（需调整数据加载部分）。</p>`,24)])])}const y=p(o,[["render",c]]),h=JSON.parse(`{"path":"/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2014/G%E4%BC%B0%E8%AE%A1%E6%AD%A5%E9%AA%A4.html","title":"G估计步骤","lang":"en-US","frontmatter":{"title":"G估计步骤","category":"Causal inference","tags":["Chapter 14","What-if book reading notes"],"description":"要正确执行 g-估计（g-estimation）来估计结构嵌套模型（SNM）参数 β=(β1​,β2​⊤)⊤，需遵循以下步骤。以下是结合数学原理和 Python 实现的完整指南： g-估计的数学原理 给定模型： E[Ya−Ya=0∣A=a,L]=β1​a+β2​⊤(aL) 定义 去混杂的潜在结果： H(β)=Y−β1​A−β2​⊤(A⊙L) 其中 ⊙ ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"G估计步骤\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-17T03:19:05.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Aaron L\\",\\"url\\":\\"https://aaronlzm.github.io\\",\\"email\\":\\"lzm_aaron@outlook.com\\"}]}"],["meta",{"property":"og:url","content":"https://aaronlzm.github.io/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2014/G%E4%BC%B0%E8%AE%A1%E6%AD%A5%E9%AA%A4.html"}],["meta",{"property":"og:site_name","content":"Aaron's Blog"}],["meta",{"property":"og:title","content":"G估计步骤"}],["meta",{"property":"og:description","content":"要正确执行 g-估计（g-estimation）来估计结构嵌套模型（SNM）参数 β=(β1​,β2​⊤)⊤，需遵循以下步骤。以下是结合数学原理和 Python 实现的完整指南： g-估计的数学原理 给定模型： E[Ya−Ya=0∣A=a,L]=β1​a+β2​⊤(aL) 定义 去混杂的潜在结果： H(β)=Y−β1​A−β2​⊤(A⊙L) 其中 ⊙ ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-09-17T03:19:05.000Z"}],["meta",{"property":"article:tag","content":"What-if book reading notes"}],["meta",{"property":"article:tag","content":"Chapter 14"}],["meta",{"property":"article:modified_time","content":"2025-09-17T03:19:05.000Z"}]],"full":"2025-09-17T03:19:05.000Z"},"git":{"createdTime":1758079145000,"updatedTime":1758079145000,"contributors":[{"name":"lizhimou","username":"lizhimou","email":"lizhimou@bytedance.com","commits":1,"url":"https://github.com/lizhimou"}]},"readingTime":{"minutes":4.05,"words":1214},"filePathRelative":"posts/Causal inference/What-if book reading notes/Chapter 14/G估计步骤.md","excerpt":"<p>要正确执行 g-估计（g-estimation）来估计结构嵌套模型（SNM）参数 <span v-pre=\\"\\" class=\\"katex\\"><span class=\\"katex-mathml\\"><math xmlns=\\"http://www.w3.org/1998/Math/MathML\\"><semantics><mrow><mi mathvariant=\\"bold-italic\\">β</mi><mo>=</mo><mo stretchy=\\"false\\">(</mo><msub><mi>β</mi><mn>1</mn></msub><mo separator=\\"true\\">,</mo><msup><mi><msub><mi mathvariant=\\"bold-italic\\">β</mi><mn mathvariant=\\"bold\\">2</mn></msub></mi><mi mathvariant=\\"normal\\">⊤</mi></msup><msup><mo stretchy=\\"false\\">)</mo><mi mathvariant=\\"normal\\">⊤</mi></msup></mrow><annotation encoding=\\"application/x-tex\\">\\\\boldsymbol{\\\\beta} = (\\\\beta_1, \\\\boldsymbol{\\\\beta_2}^\\\\top)^\\\\top</annotation></semantics></math></span><span class=\\"katex-html\\" aria-hidden=\\"true\\"><span class=\\"base\\"><span class=\\"strut\\" style=\\"height:0.8889em;vertical-align:-0.1944em;\\"></span><span class=\\"mord\\"><span class=\\"mord\\"><span class=\\"mord boldsymbol\\" style=\\"margin-right:0.03403em;\\">β</span></span></span><span class=\\"mspace\\" style=\\"margin-right:0.2778em;\\"></span><span class=\\"mrel\\">=</span><span class=\\"mspace\\" style=\\"margin-right:0.2778em;\\"></span></span><span class=\\"base\\"><span class=\\"strut\\" style=\\"height:1.1834em;vertical-align:-0.25em;\\"></span><span class=\\"mopen\\">(</span><span class=\\"mord\\"><span class=\\"mord mathnormal\\" style=\\"margin-right:0.05278em;\\">β</span><span class=\\"msupsub\\"><span class=\\"vlist-t vlist-t2\\"><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.3011em;\\"><span style=\\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\\"><span class=\\"pstrut\\" style=\\"height:2.7em;\\"></span><span class=\\"sizing reset-size6 size3 mtight\\"><span class=\\"mord mtight\\">1</span></span></span></span><span class=\\"vlist-s\\">​</span></span><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.15em;\\"><span></span></span></span></span></span></span><span class=\\"mpunct\\">,</span><span class=\\"mspace\\" style=\\"margin-right:0.1667em;\\"></span><span class=\\"mord\\"><span class=\\"mord\\"><span class=\\"mord\\"><span class=\\"mord\\"><span class=\\"mord boldsymbol\\" style=\\"margin-right:0.03403em;\\">β</span><span class=\\"msupsub\\"><span class=\\"vlist-t vlist-t2\\"><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.3011em;\\"><span style=\\"top:-2.55em;margin-left:-0.034em;margin-right:0.05em;\\"><span class=\\"pstrut\\" style=\\"height:2.7em;\\"></span><span class=\\"sizing reset-size6 size3 mtight\\"><span class=\\"mord mathbf mtight\\">2</span></span></span></span><span class=\\"vlist-s\\">​</span></span><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.15em;\\"><span></span></span></span></span></span></span></span></span><span class=\\"msupsub\\"><span class=\\"vlist-t\\"><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.9334em;\\"><span style=\\"top:-3.1473em;margin-right:0.05em;\\"><span class=\\"pstrut\\" style=\\"height:2.7em;\\"></span><span class=\\"sizing reset-size6 size3 mtight\\"><span class=\\"mord mtight\\">⊤</span></span></span></span></span></span></span></span><span class=\\"mclose\\"><span class=\\"mclose\\">)</span><span class=\\"msupsub\\"><span class=\\"vlist-t\\"><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.8491em;\\"><span style=\\"top:-3.063em;margin-right:0.05em;\\"><span class=\\"pstrut\\" style=\\"height:2.7em;\\"></span><span class=\\"sizing reset-size6 size3 mtight\\"><span class=\\"mord mtight\\">⊤</span></span></span></span></span></span></span></span></span></span></span>，需遵循以下步骤。以下是结合数学原理和 Python 实现的完整指南：</p>","autoDesc":true}`);export{y as comp,h as data};
