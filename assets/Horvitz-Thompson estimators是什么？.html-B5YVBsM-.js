import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,d as t,f as r,g as a,b as i}from"./app-ZrqzkeZK.js";const s={};function l(h,n){return i(),e("div",null,[...n[0]||(n[0]=[t("p",null,[t("strong",null,"Horvitz-Thompson (HT) 估计量"),a("是抽样调查与因果推断中的核心估计方法，用于解决"),t("strong",null,"基于不等概率抽样或存在混杂时的总体均值估计"),a("问题。其核心思想是通过**逆概率加权（Inverse Probability Weighting, IPW）**校正选择偏差或混杂偏倚。以下是关键要点解析：")],-1),t("hr",null,null,-1),t("h3",{id:"一、基本定义与公式",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#一、基本定义与公式"},[t("span",null,[t("strong",null,"一、基本定义与公式")])])],-1),t("h4",{id:"_1-基础形式",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#_1-基础形式"},[t("span",null,[t("strong",null,"1. 基础形式")])])],-1),t("ul",null,[t("li",null,[a("对于总体中个体 (i) 的观测值 (Y_i) 和处理 (A_i)，HT 估计量定义为："),t("br"),a(" ["),t("br"),a(" \\hat{\\mu}"),t("em",{i:"1"},"{a}^{\\text{HT}} = \\frac{1}{n} \\sum"),a("^{n} \\frac{I(A_i = a) \\cdot Y_i}{f(A_i = a | L_i)}"),t("br"),a(" ] "),t("ul",null,[t("li",null,"(I(A_i = a))：指示函数（当个体 (i) 接受处理 (a) 时为 1，否则为 0）。"),t("li",null,"(f(A_i = a | L_i))：倾向性评分（给定协变量 (L_i) 下接受处理 (a) 的概率）。")])])],-1),r('<h4 id="_2-目标" tabindex="-1"><a class="header-anchor" href="#_2-目标"><span><strong>2. 目标</strong></span></a></h4><ul><li>估计<strong>反事实均值</strong> (E[Y^a])（若所有个体强制接受处理 (a) 的潜在结果均值）。</li><li>需满足假设：<strong>可交换性</strong>（(Y^a \\perp A \\mid L)）、<strong>正性</strong>（(0 &lt; f(A=a \\mid L) &lt; 1)）、<strong>一致性</strong>（(A=a) 时 (Y = Y^a)）。</li></ul><hr><h3 id="二、为何需要改进为-hajek-估计量" tabindex="-1"><a class="header-anchor" href="#二、为何需要改进为-hajek-估计量"><span><strong>二、为何需要改进为 Hajek 估计量？</strong></span></a></h3><h4 id="问题-1-极端权重放大方差" tabindex="-1"><a class="header-anchor" href="#问题-1-极端权重放大方差"><span><strong>问题 1：极端权重放大方差</strong></span></a></h4><ul><li>若 (f(A=a \\mid L_i) \\approx 0)（倾向性评分接近 0），权重 (\\frac{1}{f(A=a \\mid L_i)}) 极大 → 估计量方差爆炸式增长。</li><li><strong>例</strong>：在戒烟研究中，66 岁白人女性的 (\\text{Pr}(A=1 \\mid L) \\approx 0)，权重可能达 100+ 倍。</li></ul><h4 id="问题-2-不保证估计值在合理范围" tabindex="-1"><a class="header-anchor" href="#问题-2-不保证估计值在合理范围"><span><strong>问题 2：不保证估计值在合理范围</strong></span></a></h4><ul><li>对二值结局 (Y \\in {0,1})，HT 估计值可能超出 ([0,1]) 范围（不符合概率性质）。</li></ul><h4 id="解决方案-hajek-估计量" tabindex="-1"><a class="header-anchor" href="#解决方案-hajek-估计量"><span><strong>解决方案：Hajek 估计量</strong></span></a></h4>',9),t("p",null,[a("["),t("br"),a(" \\hat{\\mu}"),t("em",{i:"1"},"{a}^{\\text{Hajek}} = \\frac{ \\sum"),a("^{n} \\frac{I(A_i = a) \\cdot Y_i}{f(A_i = a | L_i)} }{ \\sum_{i=1}^{n} \\frac{I(A_i = a)}{f(A_i = a | L_i)} }"),t("br"),a(" ]")],-1),r('<ul><li><strong>分子</strong>：HT 估计量的分子（加权观测结果之和）。</li><li><strong>分母</strong>：加权处理指示函数之和（估计伪总体中接受处理 (a) 的比例）。</li></ul><hr><h3 id="三、hajek-估计量的优势" tabindex="-1"><a class="header-anchor" href="#三、hajek-估计量的优势"><span><strong>三、Hajek 估计量的优势</strong></span></a></h3><table><thead><tr><th><strong>性质</strong></th><th><strong>Horvitz-Thompson</strong></th><th><strong>Hajek</strong></th></tr></thead><tbody><tr><td><strong>无偏性</strong></td><td>渐近无偏</td><td>渐近无偏</td></tr><tr><td><strong>方差</strong></td><td>可能极大</td><td>更小（抑制极端权重影响）</td></tr><tr><td><strong>取值范围</strong></td><td>可能超出 ([0,1])</td><td>保证在 ([0,1]) 内</td></tr><tr><td><strong>实际应用频率</strong></td><td>少</td><td>多（如 MSM 的加权回归）</td></tr></tbody></table><hr><h3 id="四、与边际结构模型-msm-的关系" tabindex="-1"><a class="header-anchor" href="#四、与边际结构模型-msm-的关系"><span><strong>四、与边际结构模型（MSM）的关系</strong></span></a></h3><p>在因果推断中，Hajek 估计量等价于 <strong>MSM 的加权最小二乘估计</strong>：</p>',7),t("ol",null,[t("li",null,[t("strong",null,"模型设定"),a("：饱和 MSM (E[Y^a] = \\beta_0 + \\beta_1 a)。")]),t("li",null,[t("strong",null,"加权回归"),a("： "),t("ul",null,[t("li",null,"用权重 (W_i = \\frac{1}{f(A_i \\mid L_i)}) 拟合线性模型 (E[Y \\mid A] = \\theta_0 + \\theta_1 A)。"),t("li",null,[a("所得 (\\hat{\\theta}"),t("em",{1:""},"1) 即为 (\\hat{\\mu}"),a("^{\\text{Hajek}} - \\hat{\\mu}_{0}^{\\text{Hajek}})（因果效应估计）。")])])])],-1),r('<hr><h3 id="五、非正性-nonpositivity-下的修正" tabindex="-1"><a class="header-anchor" href="#五、非正性-nonpositivity-下的修正"><span><strong>五、非正性（Nonpositivity）下的修正</strong></span></a></h3><p>当存在 <strong>结构性非正性</strong>（某些 (L=l) 下 (f(A=a \\mid L=l)=0)）时：</p><ul><li>HT 估计量 → 估计 (E[Y^a \\mid L \\in Q(a)])（(Q(a) = {l: f(A=a \\mid L=l)&gt;0}) 的子群体）。</li><li>Hajek 估计量 → 估计 (E[Y^a \\mid L \\in Q(a)] \\cdot \\text{Pr}[Q(a)])（需额外校正）。</li></ul><hr><h3 id="六、实例说明-nhefs-戒烟研究" tabindex="-1"><a class="header-anchor" href="#六、实例说明-nhefs-戒烟研究"><span><strong>六、实例说明（NHEFS 戒烟研究）</strong></span></a></h3><ul><li><strong>原始 HT 估计</strong>：直接加权观测增重 (Y_i)，权重 (W_i = 1 / \\text{Pr}(A_i \\mid L_i))。</li><li><strong>问题</strong>：权重范围 1.05–16.7 → 高方差。</li><li><strong>Hajek 解决方案</strong>： <ul><li>拟合 MSM：(E[Y \\mid A] = \\theta_0 + \\theta_1 A)，权重 (W_i = SW_i)（稳定权重）。</li><li>估计 ACE：(\\hat{\\theta}_1 = 3.4) kg（95% CI: 2.4–4.5）。</li></ul></li></ul><hr><h3 id="关键结论" tabindex="-1"><a class="header-anchor" href="#关键结论"><span><strong>关键结论</strong></span></a></h3><ul><li><strong>Horvitz-Thompson</strong> 是 IPW 的理论基础，但因极端权重问题<strong>实际很少直接使用</strong>。</li><li><strong>Hajek 估计量</strong>是其改进版，通过标准化分母控制方差，是 <strong>MSM 和 IPW 实践的核心</strong>。</li><li>在因果推断中，Hajek 估计量等价于 <strong>加权最小二乘</strong>，用于估计边际结构模型参数。</li></ul>',10)])])}const p=o(s,[["render",l]]),m=JSON.parse(`{"path":"/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2012/Horvitz-Thompson%20estimators%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.html","title":"Horvitz-Thompson estimators是什么？","lang":"en-US","frontmatter":{"title":"Horvitz-Thompson estimators是什么？","category":"Causal inference","tags":["Chapter 12","What-if book reading notes"],"description":"Horvitz-Thompson (HT) 估计量是抽样调查与因果推断中的核心估计方法，用于解决基于不等概率抽样或存在混杂时的总体均值估计问题。其核心思想是通过**逆概率加权（Inverse Probability Weighting, IPW）**校正选择偏差或混杂偏倚。以下是关键要点解析： 一、基本定义与公式 1. 基础形式 对于总体中个体 (i)...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Horvitz-Thompson estimators是什么？\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-17T03:19:05.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Aaron L\\",\\"url\\":\\"https://aaronlzm.github.io\\",\\"email\\":\\"lzm_aaron@outlook.com\\"}]}"],["meta",{"property":"og:url","content":"https://aaronlzm.github.io/posts/Causal%20inference/What-if%20book%20reading%20notes/Chapter%2012/Horvitz-Thompson%20estimators%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.html"}],["meta",{"property":"og:site_name","content":"Aaron's Blog"}],["meta",{"property":"og:title","content":"Horvitz-Thompson estimators是什么？"}],["meta",{"property":"og:description","content":"Horvitz-Thompson (HT) 估计量是抽样调查与因果推断中的核心估计方法，用于解决基于不等概率抽样或存在混杂时的总体均值估计问题。其核心思想是通过**逆概率加权（Inverse Probability Weighting, IPW）**校正选择偏差或混杂偏倚。以下是关键要点解析： 一、基本定义与公式 1. 基础形式 对于总体中个体 (i)..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-09-17T03:19:05.000Z"}],["meta",{"property":"article:tag","content":"What-if book reading notes"}],["meta",{"property":"article:tag","content":"Chapter 12"}],["meta",{"property":"article:modified_time","content":"2025-09-17T03:19:05.000Z"}]]},"git":{"createdTime":1758079145000,"updatedTime":1758079145000,"contributors":[{"name":"lizhimou","username":"lizhimou","email":"lizhimou@bytedance.com","commits":1,"url":"https://github.com/lizhimou"}]},"readingTime":{"minutes":3.06,"words":918},"filePathRelative":"posts/Causal inference/What-if book reading notes/Chapter 12/Horvitz-Thompson estimators是什么？.md","excerpt":"<p><strong>Horvitz-Thompson (HT) 估计量</strong>是抽样调查与因果推断中的核心估计方法，用于解决<strong>基于不等概率抽样或存在混杂时的总体均值估计</strong>问题。其核心思想是通过**逆概率加权（Inverse Probability Weighting, IPW）**校正选择偏差或混杂偏倚。以下是关键要点解析：</p>\\n<hr>\\n<h3><strong>一、基本定义与公式</strong></h3>","autoDesc":true}`);export{p as comp,m as data};
